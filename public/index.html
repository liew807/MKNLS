<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>MKNLS工具平台V3.0</title>
<link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;500;600;700;800;900&family=Exo+2:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/toastify-js/1.12.0/toastify.min.css">
<style>
    * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
        -webkit-tap-highlight-color: transparent;
        font-family: 'Exo 2', 'Orbitron', -apple-system, BlinkMacSystemFont, sans-serif;
    }

    :root {
        --primary-blue: #0066ff;
        --cyber-blue: #00f3ff;
        --cyber-pink: #ff00ff;
        --cyber-purple: #9d00ff;
        --cyber-green: #00ff9d;
        --cyber-red: #ff0055;
        --cyber-yellow: #ffff00;
        --cyber-orange: #ff7700;
        --dark-bg: #0a0a14;
        --darker-bg: #05050a;
        --card-bg: rgba(20, 20, 40, 0.92);
        --glass-border: rgba(0, 243, 255, 0.25);
        --glow-blue: 0 0 25px rgba(0, 243, 255, 0.6);
        --glow-pink: 0 0 25px rgba(255, 0, 255, 0.6);
        --glow-green: 0 0 25px rgba(0, 255, 157, 0.6);
        --glow-red: 0 0 25px rgba(255, 0, 85, 0.6);
    }

    body {
        background: linear-gradient(135deg, #05050a 0%, #0a0a14 30%, #12122a 70%, #05050a 100%);
        min-height: 100vh;
        display: flex;
        flex-direction: column;
        align-items: center;
        padding: 20px 16px;
        color: #ffffff;
        position: relative;
        overflow-x: hidden;
        font-family: 'Exo 2', sans-serif;
    }

    /* 科技网格背景 */
    .grid-bg {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-image: 
            linear-gradient(rgba(0, 243, 255, 0.04) 1px, transparent 1px),
            linear-gradient(90deg, rgba(0, 243, 255, 0.04) 1px, transparent 1px);
        background-size: 60px 60px;
        z-index: 1;
        pointer-events: none;
        animation: gridMove 40s linear infinite;
    }

    @keyframes gridMove {
        0% { transform: translate(0, 0); }
        100% { transform: translate(60px, 60px); }
    }

    /* 动态数据流效果 */
    .data-stream {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        z-index: 2;
        pointer-events: none;
        overflow: hidden;
    }

    .stream-line {
        position: absolute;
        width: 2px;
        height: 100px;
        background: linear-gradient(transparent, var(--cyber-blue), transparent);
        animation: streamFall linear infinite;
        opacity: 0.3;
    }

    @keyframes streamFall {
        0% { transform: translateY(-100px); opacity: 0; }
        10% { opacity: 1; }
        90% { opacity: 1; }
        100% { transform: translateY(100vh); opacity: 0; }
    }

    /* 主容器 */
    .cyber-container {
        width: 100%;
        max-width: 800px;
        position: relative;
        z-index: 10;
        margin: 0 auto;
    }

    /* 顶部标题栏 */
    .cyber-header {
        text-align: center;
        margin-bottom: 30px;
        padding: 40px 30px;
        background: rgba(10, 10, 20, 0.7);
        border-radius: 25px;
        backdrop-filter: blur(25px);
        border: 1px solid var(--glass-border);
        position: relative;
        overflow: hidden;
        box-shadow: 
            0 15px 35px rgba(0, 0, 0, 0.4),
            inset 0 1px 0 rgba(255, 255, 255, 0.1);
        background: linear-gradient(
            135deg,
            rgba(20, 20, 40, 0.9) 0%,
            rgba(10, 10, 30, 0.9) 100%
        );
    }

    .cyber-header::before {
        content: '';
        position: absolute;
        top: 0;
        left: -100%;
        width: 200%;
        height: 100%;
        background: linear-gradient(
            90deg,
            transparent 20%,
            rgba(0, 243, 255, 0.1) 50%,
            rgba(255, 0, 255, 0.1) 70%,
            transparent 80%
        );
        animation: headerScan 8s linear infinite;
    }

    @keyframes headerScan {
        0% { transform: translateX(-50%); }
        100% { transform: translateX(50%); }
    }

    .main-title {
        font-size: 3.5rem;
        font-weight: 900;
        margin-bottom: 20px;
        background: linear-gradient(45deg, 
            var(--cyber-blue), 
            var(--cyber-pink),
            var(--cyber-purple),
            var(--cyber-blue));
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
        background-size: 300% 300%;
        animation: titleGlow 4s ease infinite;
        text-transform: uppercase;
        letter-spacing: 3px;
        font-family: 'Orbitron', sans-serif;
        text-shadow: 0 0 30px rgba(0, 243, 255, 0.3);
    }

    @keyframes titleGlow {
        0%, 100% { background-position: 0% 50%; }
        50% { background-position: 100% 50%; }
    }

    .sub-title {
        font-size: 1.3rem;
        color: rgba(255, 255, 255, 0.8);
        letter-spacing: 5px;
        text-transform: uppercase;
        position: relative;
        display: inline-block;
        padding: 0 20px;
        margin-bottom: 15px;
        font-family: 'Orbitron', sans-serif;
        font-weight: 500;
    }

    .sub-title::before,
    .sub-title::after {
        content: '⚡';
        position: absolute;
        top: 50%;
        transform: translateY(-50%);
        color: var(--cyber-blue);
        animation: sparkle 1.5s ease-in-out infinite alternate;
        filter: drop-shadow(0 0 5px var(--cyber-blue));
    }

    .sub-title::before { left: 0; }
    .sub-title::after { right: 0; }

    .version-badge {
        display: inline-block;
        padding: 8px 20px;
        background: linear-gradient(135deg, 
            rgba(0, 243, 255, 0.2), 
            rgba(157, 0, 255, 0.2));
        border-radius: 25px;
        font-size: 0.9rem;
        font-weight: 600;
        color: var(--cyber-blue);
        margin-top: 15px;
        border: 1px solid rgba(0, 243, 255, 0.3);
        backdrop-filter: blur(10px);
        text-transform: uppercase;
        letter-spacing: 1px;
        font-family: 'Orbitron', sans-serif;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
    }

    /* 快捷入口按钮 */
    .quick-access {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 15px;
        margin-bottom: 30px;
    }

    .quick-btn {
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 12px;
        padding: 20px;
        border: none;
        border-radius: 15px;
        color: white;
        font-size: 16px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        text-decoration: none;
        position: relative;
        overflow: hidden;
        backdrop-filter: blur(10px);
        border: 1px solid rgba(255, 255, 255, 0.1);
        box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3);
    }

    .quick-btn.ks {
        background: linear-gradient(135deg, 
            #ff0066 0%, 
            #ff3300 50%, 
            #ffcc00 100%);
    }

    .quick-btn.tg {
        background: linear-gradient(135deg, 
            #0088cc 0%, 
            #34aadf 50%, 
            #66ccff 100%);
    }

    .quick-btn::before {
        content: '';
        position: absolute;
        top: 0;
        left: -100%;
        width: 100%;
        height: 100%;
        background: linear-gradient(90deg, 
            transparent, 
            rgba(255, 255, 255, 0.2), 
            transparent);
        transition: 0.5s;
    }

    .quick-btn:hover {
        transform: translateY(-5px) scale(1.02);
        box-shadow: 0 15px 35px rgba(0, 0, 0, 0.4);
    }

    .quick-btn:hover::before {
        left: 100%;
    }

    /* 主功能卡片 */
    .cyber-card {
        background: linear-gradient(
            135deg,
            rgba(15, 15, 35, 0.95) 0%,
            rgba(10, 10, 30, 0.95) 100%
        );
        backdrop-filter: blur(25px);
        border-radius: 25px;
        border: 1px solid var(--glass-border);
        padding: 30px;
        margin-bottom: 25px;
        box-shadow: 
            0 20px 40px rgba(0, 0, 0, 0.4),
            inset 0 1px 0 rgba(255, 255, 255, 0.1);
        position: relative;
        overflow: hidden;
        transition: all 0.3s ease;
    }

    .cyber-card:hover {
        box-shadow: 
            0 25px 50px rgba(0, 0, 0, 0.5),
            inset 0 1px 0 rgba(255, 255, 255, 0.15);
        border-color: rgba(0, 243, 255, 0.3);
    }

    .cyber-card::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 3px;
        background: linear-gradient(90deg, 
            var(--cyber-blue), 
            var(--cyber-pink), 
            var(--cyber-purple),
            var(--cyber-blue));
        background-size: 200% 100%;
        animation: borderGlow 3s linear infinite;
        z-index: 2;
    }

    @keyframes borderGlow {
        0% { background-position: 200% 0; }
        100% { background-position: -200% 0; }
    }

    /* 状态信息 */
    .cyber-status {
        text-align: center;
        padding: 20px;
        border-radius: 15px;
        margin-bottom: 25px;
        font-weight: 600;
        font-size: 16px;
        min-height: 50px;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 12px;
        transition: all 0.3s ease;
        background: rgba(0, 243, 255, 0.1);
        border: 1px solid rgba(0, 243, 255, 0.2);
        color: var(--cyber-blue);
        position: relative;
        overflow: hidden;
        backdrop-filter: blur(10px);
        font-family: 'Orbitron', sans-serif;
        letter-spacing: 0.5px;
    }

    .cyber-status::before {
        content: '';
        position: absolute;
        top: 0;
        left: -100%;
        width: 100%;
        height: 100%;
        background: linear-gradient(90deg, 
            transparent, 
            rgba(0, 243, 255, 0.1), 
            transparent);
        animation: statusScan 3s infinite;
    }

    @keyframes statusScan {
        0% { left: -100%; }
        100% { left: 100%; }
    }

    .cyber-status.error {
        background: rgba(255, 0, 85, 0.1);
        border: 1px solid rgba(255, 0, 85, 0.2);
        color: var(--cyber-red);
    }

    .cyber-status.success {
        background: rgba(0, 255, 157, 0.1);
        border: 1px solid rgba(0, 255, 157, 0.2);
        color: var(--cyber-green);
    }

    .cyber-status.admin {
        background: rgba(157, 0, 255, 0.1);
        border: 1px solid rgba(157, 0, 255, 0.2);
        color: var(--cyber-purple);
    }

    /* 输入框样式 */
    .cyber-input {
        width: 100%;
        padding: 20px;
        margin-bottom: 20px;
        border: 2px solid rgba(0, 243, 255, 0.2);
        border-radius: 15px;
        background: rgba(10, 10, 25, 0.8);
        font-size: 16px;
        transition: all 0.3s ease;
        outline: none;
        color: white;
        font-family: 'Exo 2', sans-serif;
        backdrop-filter: blur(10px);
        box-shadow: inset 0 2px 10px rgba(0, 0, 0, 0.3);
    }

    .cyber-input:focus {
        border-color: var(--cyber-blue);
        background: rgba(10, 10, 25, 0.9);
        box-shadow: 
            inset 0 2px 10px rgba(0, 0, 0, 0.3),
            0 0 25px var(--glow-blue);
    }

    .cyber-input::placeholder {
        color: rgba(255, 255, 255, 0.4);
    }

    /* 按钮样式 */
    .cyber-button {
        width: 100%;
        padding: 20px;
        border: none;
        border-radius: 15px;
        background: linear-gradient(135deg, 
            var(--cyber-blue) 0%, 
            var(--cyber-purple) 100%);
        color: white;
        font-size: 16px;
        font-weight: 700;
        cursor: pointer;
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        margin-bottom: 15px;
        position: relative;
        overflow: hidden;
        letter-spacing: 1px;
        text-transform: uppercase;
        font-family: 'Orbitron', sans-serif;
        box-shadow: 0 10px 25px rgba(0, 0, 0, 0.3);
        border: 1px solid rgba(255, 255, 255, 0.1);
    }

    .cyber-button::before {
        content: '';
        position: absolute;
        top: 0;
        left: -100%;
        width: 100%;
        height: 100%;
        background: linear-gradient(90deg, 
            transparent, 
            rgba(255, 255, 255, 0.2), 
            transparent);
        transition: 0.5s;
    }

    .cyber-button:hover {
        transform: translateY(-5px);
        box-shadow: 
            0 20px 40px rgba(0, 0, 0, 0.4),
            0 0 30px rgba(0, 243, 255, 0.4);
    }

    .cyber-button:hover::before {
        left: 100%;
    }

    .cyber-button:active {
        transform: translateY(-2px);
    }

    .cyber-button.secondary {
        background: linear-gradient(135deg, 
            var(--cyber-pink) 0%, 
            var(--cyber-red) 100%);
    }

    .cyber-button.success {
        background: linear-gradient(135deg, 
            var(--cyber-green) 0%, 
            #00a8ff 100%);
    }

    .cyber-button.warning {
        background: linear-gradient(135deg, 
            var(--cyber-orange) 0%, 
            #ff3366 100%);
    }

    .cyber-button:disabled {
        background: rgba(50, 50, 70, 0.5);
        color: rgba(255, 255, 255, 0.3);
        cursor: not-allowed;
        transform: none;
        box-shadow: none;
        border-color: rgba(255, 255, 255, 0.05);
    }

    /* 导航按钮 */
    .nav-buttons {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: 15px;
        margin: 25px 0;
    }

    .nav-buttons button {
        padding: 16px;
        font-size: 14px;
    }

    /* 过期时间显示 */
    .expiry-display {
        text-align: center;
        margin: 25px 0;
        padding: 20px;
        background: linear-gradient(135deg, 
            rgba(0, 243, 255, 0.1), 
            rgba(157, 0, 255, 0.1));
        border-radius: 15px;
        border: 1px solid rgba(0, 243, 255, 0.2);
        color: var(--cyber-blue);
        font-size: 14px;
        line-height: 1.6;
        backdrop-filter: blur(10px);
        position: relative;
        overflow: hidden;
    }

    .blinking-expiry {
        animation: blink 1.5s infinite;
        font-weight: bold;
        color: var(--cyber-red);
        margin-top: 10px;
        text-shadow: 0 0 10px rgba(255, 0, 85, 0.5);
        font-family: 'Orbitron', sans-serif;
    }

    @keyframes blink {
        0%, 100% { opacity: 1; }
        50% { opacity: 0.5; }
    }

    /* 绑定信息 */
    .bind-info {
        text-align: center;
        margin: 20px 0;
        padding: 15px;
        background: linear-gradient(135deg, 
            rgba(255, 149, 0, 0.1), 
            rgba(255, 94, 0, 0.1));
        border-radius: 12px;
        border: 1px solid rgba(255, 149, 0, 0.3);
        color: #FF9500;
        font-size: 14px;
        font-weight: 600;
        backdrop-filter: blur(10px);
        font-family: 'Orbitron', sans-serif;
        letter-spacing: 0.5px;
    }

    /* 管理员面板 */
    .admin-panel {
        border-top: 1px solid rgba(0, 243, 255, 0.3);
        padding-top: 30px;
        margin-top: 30px;
    }

    .admin-title {
        text-align: center;
        font-size: 26px;
        font-weight: 800;
        margin-bottom: 25px;
        background: linear-gradient(45deg, var(--cyber-blue), var(--cyber-pink));
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
        text-transform: uppercase;
        font-family: 'Orbitron', sans-serif;
        text-shadow: 0 0 20px rgba(0, 243, 255, 0.3);
    }

    .admin-level-badge {
        background: linear-gradient(45deg, var(--cyber-pink), var(--cyber-purple));
        color: white;
        padding: 6px 15px;
        border-radius: 25px;
        font-size: 12px;
        font-weight: 700;
        margin-left: 15px;
        text-transform: uppercase;
        letter-spacing: 1px;
        font-family: 'Orbitron', sans-serif;
        box-shadow: 0 5px 15px rgba(157, 0, 255, 0.3);
    }

    /* 密钥列表样式 */
    .key-table-container {
        background: rgba(10, 10, 25, 0.7);
        border-radius: 15px;
        padding: 20px;
        border: 1px solid rgba(0, 243, 255, 0.1);
        backdrop-filter: blur(10px);
        margin-bottom: 20px;
    }

    .key-table-title {
        color: var(--cyber-blue);
        font-size: 18px;
        font-weight: 700;
        margin-bottom: 20px;
        padding-bottom: 10px;
        border-bottom: 2px solid rgba(0, 243, 255, 0.2);
        text-transform: uppercase;
        font-family: 'Orbitron', sans-serif;
        letter-spacing: 1px;
    }

    .key-item {
        background: rgba(20, 20, 40, 0.6);
        border-radius: 12px;
        padding: 20px;
        margin-bottom: 15px;
        border: 1px solid rgba(255, 255, 255, 0.05);
        transition: all 0.3s ease;
        position: relative;
        overflow: hidden;
    }

    .key-item:hover {
        background: rgba(25, 25, 50, 0.8);
        border-color: rgba(0, 243, 255, 0.2);
        transform: translateX(5px);
        box-shadow: 0 10px 20px rgba(0, 0, 0, 0.3);
    }

    .key-info-row {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 10px;
    }

    .key-value {
        font-family: 'Courier New', monospace;
        background: rgba(0, 0, 0, 0.3);
        padding: 10px 15px;
        border-radius: 8px;
        border: 1px solid rgba(0, 243, 255, 0.2);
        color: var(--cyber-blue);
        font-weight: 600;
        letter-spacing: 1px;
        flex: 1;
        margin-right: 15px;
        font-size: 16px;
    }

    .key-meta {
        display: flex;
        gap: 10px;
        flex-wrap: wrap;
    }

    .key-badge {
        padding: 5px 12px;
        border-radius: 20px;
        font-size: 12px;
        font-weight: 700;
        text-transform: uppercase;
        letter-spacing: 0.5px;
        font-family: 'Orbitron', sans-serif;
    }

    .badge-admin {
        background: linear-gradient(45deg, var(--cyber-purple), var(--cyber-pink));
        color: white;
    }

    .badge-test {
        background: linear-gradient(45deg, var(--cyber-orange), var(--cyber-red));
        color: white;
    }

    .badge-active {
        background: linear-gradient(45deg, var(--cyber-green), #00a8ff);
        color: white;
    }

    .badge-expired {
        background: linear-gradient(45deg, #666, #999);
        color: white;
    }

    .key-details {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 15px;
        margin-top: 15px;
        font-size: 14px;
        color: rgba(255, 255, 255, 0.7);
    }

    .detail-item {
        background: rgba(0, 0, 0, 0.2);
        padding: 10px;
        border-radius: 8px;
        border: 1px solid rgba(255, 255, 255, 0.05);
    }

    .detail-label {
        color: var(--cyber-blue);
        font-weight: 600;
        margin-bottom: 5px;
        font-size: 12px;
        text-transform: uppercase;
        letter-spacing: 0.5px;
    }

    .key-actions {
        display: flex;
        gap: 10px;
        margin-top: 15px;
        justify-content: flex-end;
    }

    .action-btn {
        padding: 10px 20px;
        border: none;
        border-radius: 8px;
        font-size: 13px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
        text-transform: uppercase;
        letter-spacing: 0.5px;
        font-family: 'Orbitron', sans-serif;
        display: flex;
        align-items: center;
        gap: 8px;
        min-width: 120px;
        justify-content: center;
    }

    .action-btn.copy {
        background: linear-gradient(135deg, var(--cyber-blue), #0099ff);
        color: white;
        border: 1px solid rgba(0, 243, 255, 0.3);
    }

    .action-btn.delete {
        background: linear-gradient(135deg, var(--cyber-red), #ff3366);
        color: white;
        border: 1px solid rgba(255, 0, 85, 0.3);
    }

    .action-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 8px 15px rgba(0, 0, 0, 0.3);
    }

    .action-btn:active {
        transform: translateY(0);
    }

    /* 空状态 */
    .empty-state {
        text-align: center;
        padding: 60px 20px;
        color: rgba(255, 255, 255, 0.5);
        font-size: 16px;
        background: rgba(20, 20, 40, 0.3);
        border-radius: 15px;
        border: 2px dashed rgba(0, 243, 255, 0.1);
    }

    .empty-icon {
        font-size: 48px;
        margin-bottom: 20px;
        color: rgba(0, 243, 255, 0.3);
    }

    /* 日志容器 */
    .log-container {
        background: linear-gradient(
            135deg,
            rgba(15, 15, 35, 0.95) 0%,
            rgba(10, 10, 30, 0.95) 100%
        );
        backdrop-filter: blur(25px);
        border-radius: 20px;
        padding: 25px;
        border: 1px solid var(--glass-border);
        max-height: 300px;
        overflow-y: auto;
        margin-top: 25px;
        box-shadow: 
            0 15px 35px rgba(0, 0, 0, 0.4),
            inset 0 1px 0 rgba(255, 255, 255, 0.1);
    }

    .log-title {
        color: var(--cyber-green);
        font-size: 18px;
        font-weight: 700;
        margin-bottom: 20px;
        padding-bottom: 10px;
        border-bottom: 2px solid rgba(0, 255, 157, 0.2);
        text-transform: uppercase;
        letter-spacing: 2px;
        font-family: 'Orbitron', sans-serif;
        text-align: center;
    }

    .log-item {
        font-size: 14px;
        padding: 12px 0;
        border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        line-height: 1.5;
        color: rgba(255, 255, 255, 0.8);
        display: flex;
        align-items: flex-start;
        gap: 12px;
    }

    .log-item:last-child {
        border-bottom: none;
    }

    .log-time {
        color: var(--cyber-blue);
        min-width: 70px;
        font-family: 'Courier New', monospace;
        font-size: 12px;
        opacity: 0.7;
    }

    .log-content {
        flex: 1;
    }

    /* 语言选择器 */
    .language-selector {
        position: absolute;
        top: 25px;
        right: 25px;
        z-index: 1000;
    }

    .language-dropdown {
        background: rgba(20, 20, 40, 0.9);
        border: 1px solid var(--glass-border);
        border-radius: 10px;
        padding: 12px 20px;
        color: var(--cyber-blue);
        font-size: 14px;
        font-weight: 600;
        cursor: pointer;
        backdrop-filter: blur(10px);
        min-width: 140px;
        font-family: 'Exo 2', sans-serif;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        transition: all 0.3s ease;
    }

    .language-dropdown:hover {
        border-color: var(--cyber-blue);
        box-shadow: 0 0 20px rgba(0, 243, 255, 0.3);
    }

    .language-dropdown option {
        background: var(--dark-bg);
        color: white;
        padding: 10px;
    }

    /* 加载动画 */
    .cyber-spinner {
        display: inline-block;
        width: 24px;
        height: 24px;
        border: 3px solid rgba(0, 243, 255, 0.3);
        border-radius: 50%;
        border-top-color: var(--cyber-blue);
        animation: spin 1s linear infinite;
        margin-right: 10px;
    }

    @keyframes spin {
        to { transform: rotate(360deg); }
    }

    /* 响应式设计 */
    @media (max-width: 768px) {
        .quick-access {
            grid-template-columns: 1fr;
        }
        
        .nav-buttons {
            grid-template-columns: 1fr;
        }
        
        .main-title {
            font-size: 2.5rem;
        }
        
        .key-details {
            grid-template-columns: 1fr;
        }
        
        .key-actions {
            flex-direction: column;
        }
        
        .action-btn {
            width: 100%;
        }
        
        .language-selector {
            position: relative;
            top: 0;
            right: 0;
            margin: 0 auto 20px;
            display: flex;
            justify-content: center;
        }
    }

    @media (max-width: 480px) {
        .cyber-header {
            padding: 30px 20px;
        }
        
        .main-title {
            font-size: 2rem;
        }
        
        .sub-title {
            font-size: 1rem;
            letter-spacing: 3px;
        }
        
        .cyber-card {
            padding: 20px;
            border-radius: 20px;
        }
        
        .cyber-input {
            padding: 16px;
            font-size: 15px;
        }
        
        .cyber-button {
            padding: 16px;
            font-size: 15px;
        }
        
        .admin-title {
            font-size: 22px;
        }
    }

    /* 滚动条样式 */
    ::-webkit-scrollbar {
        width: 10px;
    }

    ::-webkit-scrollbar-track {
        background: rgba(20, 20, 40, 0.3);
        border-radius: 5px;
    }

    ::-webkit-scrollbar-thumb {
        background: linear-gradient(45deg, var(--cyber-blue), var(--cyber-purple));
        border-radius: 5px;
        border: 2px solid rgba(20, 20, 40, 0.3);
    }

    ::-webkit-scrollbar-thumb:hover {
        background: linear-gradient(45deg, var(--cyber-pink), var(--cyber-purple));
    }

    /* 标签页样式 */
    .tab-container {
        display: flex;
        gap: 10px;
        margin-bottom: 25px;
        border-bottom: 1px solid rgba(0, 243, 255, 0.1);
        padding-bottom: 15px;
    }

    .tab-btn {
        padding: 12px 25px;
        border: none;
        border-radius: 10px;
        background: rgba(20, 20, 40, 0.5);
        color: rgba(255, 255, 255, 0.7);
        font-size: 14px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
        text-transform: uppercase;
        letter-spacing: 1px;
        font-family: 'Orbitron', sans-serif;
    }

    .tab-btn.active {
        background: linear-gradient(135deg, var(--cyber-blue), var(--cyber-purple));
        color: white;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
    }

    .tab-btn:hover:not(.active) {
        background: rgba(30, 30, 50, 0.7);
        color: var(--cyber-blue);
    }

    /* 统计卡片 */
    .stats-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 20px;
        margin-bottom: 30px;
    }

    .stat-card {
        background: rgba(20, 20, 40, 0.6);
        border-radius: 15px;
        padding: 25px;
        text-align: center;
        border: 1px solid rgba(0, 243, 255, 0.1);
        transition: all 0.3s ease;
        position: relative;
        overflow: hidden;
    }

    .stat-card:hover {
        border-color: var(--cyber-blue);
        transform: translateY(-5px);
        box-shadow: 0 15px 30px rgba(0, 0, 0, 0.3);
    }

    .stat-value {
        font-size: 36px;
        font-weight: 800;
        color: var(--cyber-blue);
        margin: 15px 0;
        font-family: 'Orbitron', sans-serif;
    }

    .stat-label {
        color: rgba(255, 255, 255, 0.7);
        font-size: 14px;
        text-transform: uppercase;
        letter-spacing: 1px;
        font-family: 'Orbitron', sans-serif;
    }
</style>
</head>
<body>
    <!-- 动态网格背景 -->
    <div class="grid-bg"></div>
    
    <!-- 动态数据流 -->
    <div class="data-stream" id="dataStream"></div>

    <!-- 语言选择器 -->
    <div class="language-selector">
        <select id="languageSelect" class="language-dropdown" onchange="changeLanguage(this.value)">
            <option value="zh-CN">中文简体</option>
            <option value="zh-TW">中文繁體</option>
            <option value="en">English</option>
        </select>
    </div>

    <div class="cyber-container">
        <!-- 标题区域 -->
        <div class="cyber-header">
            <h1 class="main-title">MKNLS工具平台V3.0</h1>
            <div class="sub-title">SSM认证工具平台</div>
            <div class="version-badge">
                <i class="fas fa-bolt"></i>cpm专业平台v3.0<i class="fas fa-bolt"></i>
            </div>
        </div>

        <!-- 快捷入口 -->
        <div class="quick-access">
            <a href="https://v.kuaishou.com/n5k2Q5FF" target="_blank" class="quick-btn ks">
                <i class="fas fa-play-circle"></i>
                快手联系Jack
                <i class="fas fa-external-link-alt"></i>
            </a>
            
            <a href="https://t.me/cpmMKNLS" target="_blank" class="quick-btn tg">
                <i class="fab fa-telegram"></i>
                加入Telegram频道
            </a>
        </div>

        <!-- 主功能卡片 -->
        <div class="cyber-card">
            <!-- 状态信息 -->
            <div id="statusMessage" class="cyber-status">
                <i class="fas fa-microchip"></i> 系统就绪，请输入秘钥验证
            </div>

            <!-- 导航按钮 -->
            <div id="navButtons" style="display: none;">
                <div class="nav-buttons">
                    <button class="cyber-button secondary" onclick="handleReturnHome()" id="btnHome">
                        <i class="fas fa-home"></i> 首页
                    </button>
                    <button class="cyber-button secondary" onclick="handleSwitchAccount()" id="btnSwitchAccount">
                        <i class="fas fa-sync-alt"></i> 切换账号
                    </button>
                    <button class="cyber-button secondary" onclick="handleSwitchKey()" id="btnSwitchKey">
                        <i class="fas fa-key"></i> 切换秘钥
                    </button>
                </div>
            </div>

            <!-- 管理员模式切换 -->
            <button id="toggleAdminModeBtn" style="display: none;" class="cyber-button secondary" onclick="toggleAdminMode()" id="btnToggleAdmin">
                <i class="fas fa-user-shield"></i> 切换管理员模式
            </button>
            
            <!-- 管理员选择 -->
            <div id="adminChoice" style="display: none;">
                <div class="cyber-status admin" style="margin-bottom: 20px;">
                    <i class="fas fa-terminal"></i> 请选择您要进入的模式
                </div>
                <button class="cyber-button" onclick="enterAdminPanel()" id="btnEnterAdmin">
                    <i class="fas fa-tools"></i> 进入管理员面板
                </button>
                <button class="cyber-button secondary" onclick="enterUserPanel()" id="btnEnterUser">
                    <i class="fas fa-user"></i> 进入用户功能
                </button>
            </div>

            <!-- 秘钥验证表单 -->
            <div id="keyForm">
                <div style="text-align: center; margin-bottom: 15px; color: rgba(255,255,255,0.7); font-size: 14px;">
                    <i class="fas fa-info-circle"></i> 秘钥请 Facebook搜索GH Tree获取
                </div>
                <input type="text" id="accessKey" class="cyber-input" placeholder="输入访问秘钥" maxlength="15">
                <div id="bindInfo" class="bind-info" style="display: none;"></div>
                <button class="cyber-button" onclick="handleCheckKey()" id="btnCheckKey">
                    <span id="checkKeyText"><i class="fas fa-shield-alt"></i> 验证秘钥</span>
                </button>
            </div>

            <!-- 登录表单 -->
            <div id="loginForm" style="display: none;">
                <div id="expiryDisplay" class="expiry-display">
                    <!-- 过期时间显示 -->
                </div>
                <input type="email" id="email" class="cyber-input" placeholder="输入您的邮箱">
                <input type="password" id="password" class="cyber-input" placeholder="输入您的密码">
                <button class="cyber-button success" onclick="handleLogin()" id="btnLogin">
                    <span id="loginText"><i class="fas fa-sign-in-alt"></i> 登录</span>
                </button>
            </div>

            <!-- 功能菜单 -->
            <div id="menuButtons" style="display: none;">
                <button class="cyber-button" onclick="handleKingRank()" id="btnKingRank">
                    <i class="fas fa-crown"></i> 一键修改为国王等级
                </button>
                <button class="cyber-button secondary" id="btnChangeEmail" onclick="handleChangeEmail()">
                    <i class="fas fa-envelope"></i> 修改邮箱
                </button>
                <button class="cyber-button secondary" id="btnChangePassword" onclick="handleChangePassword()">
                    <i class="fas fa-lock"></i> 修改密码
                </button>
            </div>
            
            <!-- 管理员面板 -->
            <div id="adminPanel" class="admin-panel" style="display: none;">
                <h4 class="admin-title" id="adminTitle">
                    <i class="fas fa-key"></i> 秘钥管理中心
                    <span id="adminLevelBadge" class="admin-level-badge">超级管理员</span>
                </h4>

                <!-- 统计卡片 -->
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-value" id="totalKeys">0</div>
                        <div class="stat-label">总密钥数</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="activeKeys">0</div>
                        <div class="stat-label">激活密钥</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="testCards">0</div>
                        <div class="stat-label">测试卡</div>
                    </div>
                </div>

                <!-- 标签页 -->
                <div class="tab-container">
                    <button class="tab-btn active" onclick="switchTab('allKeys')">
                        <i class="fas fa-key"></i> 全部密钥
                    </button>
                    <button class="tab-btn" onclick="switchTab('testCardsTab')">
                        <i class="fas fa-vial"></i> 测试卡
                    </button>
                    <button class="tab-btn" onclick="switchTab('adminKeys')">
                        <i class="fas fa-user-shield"></i> 管理员
                    </button>
                </div>

                <div class="add-key-form">
                    <!-- 测试卡选项 -->
                    <div style="background: rgba(255,0,85,0.1); padding: 20px; border-radius: 12px; margin-bottom: 20px; border: 1px solid rgba(255,0,85,0.3); backdrop-filter: blur(10px);">
                        <label style="color: var(--cyber-red); display: flex; align-items: center; gap: 15px; cursor: pointer; font-size: 16px;">
                            <input type="checkbox" id="isTestCard" onchange="toggleTestCardOptions()" style="transform: scale(1.5);">
                            <span style="font-weight: 700;"><i class="fas fa-vial"></i> 生成测试卡</span>
                        </label>
                        <div style="color: rgba(255,255,255,0.7); font-size: 13px; margin-top: 10px; margin-left: 45px;">
                            <i class="fas fa-info-circle"></i> 1小时有效期，仅限1个账号，仅支持解锁成就功能
                        </div>
                    </div>

                    <!-- 普通秘钥选项 -->
                    <div id="normalKeyOptions">
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 15px;">
                            <div>
                                <div style="color: var(--cyber-blue); font-size: 14px; margin-bottom: 8px; font-weight: 600;">
                                    <i class="fas fa-clock"></i> 秘钥时长 (小时)
                                </div>
                                <input type="number" id="newKeyDuration" class="cyber-input" value="24" min="1">
                            </div>
                            <div>
                                <div style="color: var(--cyber-blue); font-size: 14px; margin-bottom: 8px; font-weight: 600;">
                                    <i class="fas fa-link"></i> 最大绑定数量
                                </div>
                                <input type="number" id="newKeyMaxBind" class="cyber-input" value="3" min="1">
                            </div>
                        </div>
                    </div>
                    
                    <div style="margin-bottom: 20px;">
                        <div style="color: var(--cyber-blue); font-size: 14px; margin-bottom: 8px; font-weight: 600;">
                            <i class="fas fa-sticky-note"></i> 备注信息
                        </div>
                        <input type="text" id="newKeyRemark" class="cyber-input" placeholder="如: 月卡/测试卡/客户名">
                    </div>
                    
                    <button class="cyber-button success" onclick="handleAddKey()" id="btnAddKey">
                        <i class="fas fa-plus"></i> <span id="addKeyText">生成新秘钥</span>
                    </button>
                </div>

                <!-- 管理按钮 -->
                <div class="nav-buttons" style="margin: 25px 0;">
                    <button class="cyber-button" onclick="fetchKeys()" id="btnRefresh">
                        <i class="fas fa-sync-alt"></i> 刷新列表
                    </button>
                    <button class="cyber-button warning" onclick="handleCleanupExpiredKeys()" id="btnCleanup">
                        <i class="fas fa-trash"></i> 清理过期
                    </button>
                </div>

                <!-- 秘钥列表容器 -->
                <div id="keyTablesContainer">
                    <!-- 密钥列表将通过JavaScript动态生成 -->
                </div>
            </div>
        </div>

        <!-- 日志容器 -->
        <div class="log-container">
            <div class="log-title">
                <i class="fas fa-terminal"></i> 系统日志
            </div>
            <div id="logHistory">
                <div class="log-item" style="color: var(--cyber-green);">
                    <span class="log-time">00:00:00</span>
                    <span class="log-content">
                        <i class="fas fa-check-circle"></i> 系统启动完成
                    </span>
                </div>
            </div>
        </div>
    </div>

    <!-- 加载Toastify -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/toastify-js/1.12.0/toastify.min.js"></script>
    
    <!-- JavaScript代码 -->
    <script>
        // ==================== 配置部分 ====================
        const API_BASE_URL = (() => {
            if (window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1') {
                return 'http://localhost:3000/api';
            }
            return '/api';
        })();

        // ==================== 多语言支持 ====================
        const translations = {
            'zh-CN': {
                'statusReady': '系统就绪，请输入秘钥验证',
                'statusVerifying': '正在验证秘钥，请稍候...',
                'statusLoggingIn': '正在登录...',
                'statusSettingRank': '正在尝试设置国王等级...',
                'statusChangingEmail': '正在修改邮箱...',
                'statusChangingPassword': '正在修改密码...',
                'keyHint': '秘钥请 Facebook搜索GH Tree获取',
                'btnCheckKey': '验证秘钥',
                'btnLogin': '登录',
                'btnKingRank': '一键修改为国王等级',
                'btnChangeEmail': '修改邮箱',
                'btnChangePassword': '修改密码',
                'btnToggleAdmin': '切换管理员模式',
                'btnHome': '首页',
                'btnSwitchAccount': '切换账号',
                'btnSwitchKey': '切换秘钥',
                'btnEnterAdmin': '进入管理员面板',
                'btnEnterUser': '进入用户功能',
                'btnAddKey': '生成新秘钥',
                'btnRefresh': '刷新列表',
                'btnCleanup': '清理过期',
                'adminTitle': '秘钥管理中心',
                'testCardLabel': '生成测试卡',
                'testCardInfo': '1小时有效期，仅限1个账号，仅支持解锁成就功能',
                'superAdmin': '超级管理员',
                'normalAdmin': '普通管理员',
                'testCardBadge': '测试卡',
                'testCardStatus': '测试卡用户',
                'testCardEmailWarning': '测试卡不支持修改邮箱功能，请联系管理员付费使用完整功能！',
                'testCardPasswordWarning': '测试卡不支持修改密码功能，请联系管理员付费使用完整功能！',
                'confirmDelete': '确定要删除这个密钥吗？此操作不可逆！',
                'confirmCleanup': '确定要清理所有过期密钥吗？此操作不可逆！',
                'copySuccess': '密钥已复制到剪贴板',
                'deleteSuccess': '密钥删除成功',
                'cleanupSuccess': '过期密钥清理完成',
                'addKeySuccess': '新密钥生成成功',
                'noKeys': '暂无密钥数据',
                'totalKeys': '总密钥数',
                'activeKeys': '激活密钥',
                'testCards': '测试卡'
            },
            'zh-TW': {
                'statusReady': '系統就緒，請輸入秘鑰驗證',
                'statusVerifying': '正在驗證秘鑰，請稍候...',
                'statusLoggingIn': '正在登錄...',
                'statusSettingRank': '正在嘗試設置國王等級...',
                'statusChangingEmail': '正在修改郵箱...',
                'statusChangingPassword': '正在修改密碼...',
                'keyHint': '秘鑰請Facebook搜索GH Tree獲取',
                'btnCheckKey': '驗證秘鑰',
                'btnLogin': '登錄',
                'btnKingRank': '一鍵修改為國王等級',
                'btnChangeEmail': '修改郵箱',
                'btnChangePassword': '修改密碼',
                'btnToggleAdmin': '切換管理員模式',
                'btnHome': '首頁',
                'btnSwitchAccount': '切換賬號',
                'btnSwitchKey': '切換秘鑰',
                'btnEnterAdmin': '進入管理員面板',
                'btnEnterUser': '進入用戶功能',
                'btnAddKey': '生成新秘鑰',
                'btnRefresh': '刷新列表',
                'btnCleanup': '清理過期',
                'adminTitle': '秘鑰管理中心',
                'testCardLabel': '生成測試卡',
                'testCardInfo': '1小時有效期，僅限1個賬號，僅支持解鎖成就功能',
                'superAdmin': '超級管理員',
                'normalAdmin': '普通管理員',
                'testCardBadge': '測試卡',
                'testCardStatus': '測試卡用戶',
                'testCardEmailWarning': '測試卡不支持修改郵箱功能，請聯繫管理員付費使用完整功能！',
                'testCardPasswordWarning': '測試卡不支持修改密碼功能，請聯繫管理員付費使用完整功能！',
                'confirmDelete': '確定要刪除這個秘鑰嗎？此操作不可逆！',
                'confirmCleanup': '確定要清理所有過期秘鑰嗎？此操作不可逆！',
                'copySuccess': '秘鑰已複製到剪貼板',
                'deleteSuccess': '秘鑰刪除成功',
                'cleanupSuccess': '過期秘鑰清理完成',
                'addKeySuccess': '新秘鑰生成成功',
                'noKeys': '暫無秘鑰數據',
                'totalKeys': '總秘鑰數',
                'activeKeys': '激活秘鑰',
                'testCards': '測試卡'
            },
            'en': {
                'statusReady': 'System ready, please enter key to verify',
                'statusVerifying': 'Verifying key, please wait...',
                'statusLoggingIn': 'Logging in...',
                'statusSettingRank': 'Setting king rank...',
                'statusChangingEmail': 'Changing email...',
                'statusChangingPassword': 'Changing password...',
                'keyHint': 'Get key by searching GH Tree on Facebook',
                'btnCheckKey': 'Verify Key',
                'btnLogin': 'Login',
                'btnKingRank': 'Set King Rank',
                'btnChangeEmail': 'Change Email',
                'btnChangePassword': 'Change Password',
                'btnToggleAdmin': 'Toggle Admin Mode',
                'btnHome': 'Home',
                'btnSwitchAccount': 'Switch Account',
                'btnSwitchKey': 'Switch Key',
                'btnEnterAdmin': 'Enter Admin Panel',
                'btnEnterUser': 'Enter User Functions',
                'btnAddKey': 'Generate New Key',
                'btnRefresh': 'Refresh List',
                'btnCleanup': 'Clean Expired',
                'adminTitle': 'Key Management Center',
                'testCardLabel': 'Generate Test Card',
                'testCardInfo': '1 hour validity, 1 account only, unlock achievement only',
                'superAdmin': 'Super Admin',
                'normalAdmin': 'Normal Admin',
                'testCardBadge': 'Test Card',
                'testCardStatus': 'Test Card User',
                'testCardEmailWarning': 'Test card does not support email change. Please contact admin for paid full features!',
                'testCardPasswordWarning': 'Test card does not support password change. Please contact admin for paid full features!',
                'confirmDelete': 'Are you sure to delete this key? This action is irreversible!',
                'confirmCleanup': 'Are you sure to clean all expired keys? This action is irreversible!',
                'copySuccess': 'Key copied to clipboard',
                'deleteSuccess': 'Key deleted successfully',
                'cleanupSuccess': 'Expired keys cleaned up',
                'addKeySuccess': 'New key generated successfully',
                'noKeys': 'No key data available',
                'totalKeys': 'Total Keys',
                'activeKeys': 'Active Keys',
                'testCards': 'Test Cards'
            }
        };

        // ==================== 全局变量 ====================
        let currentLanguage = 'zh-CN';
        let currentKey = null;
        let currentToken = null;
        let currentExpiryTime = null;
        let currentUser = null;
        let isAdminMode = false;
        let isSuperAdmin = false;
        let currentBindInfo = null;
        let isTestCard = false;
        let currentTab = 'allKeys';

        // ==================== 工具函数 ====================
        function updateStatus(message, isError = false) {
            const statusEl = document.getElementById('statusMessage');
            const icon = isError ? 'fa-exclamation-circle' : 'fa-check-circle';
            statusEl.innerHTML = `<i class="fas ${icon}"></i> ${message}`;
            
            if (isTestCard) {
                statusEl.className = 'cyber-status error';
            } else if (isAdminMode) {
                statusEl.className = 'cyber-status admin';
            } else {
                statusEl.className = 'cyber-status ' + (isError ? 'error' : 'success');
            }
        }

        function showToast(message, type = 'success') {
            const background = type === 'success' ? 'linear-gradient(to right, #00b09b, #96c93d)' :
                              type === 'error' ? 'linear-gradient(to right, #ff416c, #ff4b2b)' :
                              'linear-gradient(to right, #2193b0, #6dd5ed)';
            
            Toastify({
                text: message,
                duration: 3000,
                gravity: "top",
                position: "right",
                backgroundColor: background,
                stopOnFocus: true,
                onClick: function(){}
            }).showToast();
        }

        function setButtonLoading(buttonId, loading) {
            const button = document.getElementById(buttonId);
            if (!button) return;
            
            if (loading) {
                button.disabled = true;
                const originalText = button.innerHTML;
                button.innerHTML = `<span><span class="cyber-spinner"></span>${translations[currentLanguage].statusVerifying}</span>`;
                button.setAttribute('data-original-text', originalText);
            } else {
                button.disabled = false;
                const originalText = button.getAttribute('data-original-text');
                if (originalText) {
                    button.innerHTML = originalText;
                }
            }
        }

        function logAction(action, message, type = 'info') {
            const logHistory = document.getElementById('logHistory');
            const now = new Date().toLocaleTimeString('zh-CN', { hour12: false });
            
            let icon = 'fa-info-circle';
            let color = 'var(--cyber-blue)';
            
            switch(type) {
                case 'success': 
                    icon = 'fa-check-circle'; 
                    color = 'var(--cyber-green)';
                    break;
                case 'error': 
                    icon = 'fa-times-circle'; 
                    color = 'var(--cyber-red)';
                    break;
                case 'warning': 
                    icon = 'fa-exclamation-triangle'; 
                    color = 'var(--cyber-yellow)';
                    break;
                case 'admin':
                    icon = 'fa-user-shield';
                    color = 'var(--cyber-purple)';
                    break;
            }
            
            const logItem = document.createElement('div');
            logItem.className = 'log-item';
            logItem.innerHTML = `
                <span class="log-time">${now}</span>
                <span class="log-content">
                    <i class="fas ${icon}" style="color: ${color};"></i> ${message}
                </span>
            `;
            
            logHistory.prepend(logItem);
            
            // 保持日志数量在20条以内
            while (logHistory.children.length > 20) {
                logHistory.removeChild(logHistory.lastChild);
            }
        }

        function copyToClipboard(text) {
            navigator.clipboard.writeText(text).then(() => {
                showToast(translations[currentLanguage].copySuccess, 'success');
                logAction('复制', `已复制密钥: ${text.substring(0, 8)}...`, 'success');
            }).catch(err => {
                console.error('复制失败:', err);
                showToast('复制失败，请手动复制', 'error');
            });
        }

        function formatDate(dateString) {
            if (!dateString) return '未知';
            const date = new Date(dateString);
            return date.toLocaleString('zh-CN', {
                year: 'numeric',
                month: '2-digit',
                day: '2-digit',
                hour: '2-digit',
                minute: '2-digit'
            });
        }

        function formatTimeLeft(expiryTime) {
            if (!expiryTime) return '';
            const now = new Date();
            const expiry = new Date(expiryTime);
            const diffMs = expiry - now;
            
            if (diffMs <= 0) return '已过期';
            
            const diffHours = Math.floor(diffMs / (1000 * 60 * 60));
            const diffDays = Math.floor(diffHours / 24);
            
            if (diffDays > 0) {
                return `剩余 ${diffDays} 天 ${diffHours % 24} 小时`;
            }
            return `剩余 ${diffHours} 小时`;
        }

        // ==================== 数据流效果 ====================
        function createDataStream() {
            const streamContainer = document.getElementById('dataStream');
            for (let i = 0; i < 15; i++) {
                const line = document.createElement('div');
                line.className = 'stream-line';
                line.style.left = `${Math.random() * 100}%`;
                line.style.animationDuration = `${3 + Math.random() * 7}s`;
                line.style.animationDelay = `${Math.random() * 5}s`;
                streamContainer.appendChild(line);
            }
        }

        // ==================== 核心功能函数 ====================
        async function handleCheckKey(key = null) {
            key = key || document.getElementById('accessKey').value.trim();
            if (!key) {
                updateStatus('请输入秘钥！', true);
                showToast('请输入秘钥！', 'error');
                return;
            }
            
            setButtonLoading('btnCheckKey', true);
            updateStatus('正在验证秘钥，请稍候...', false);
            
            try {
                const email = document.getElementById('email') ? document.getElementById('email').value.trim() : null;
                
                const response = await fetch(`${API_BASE_URL}/check-key`, {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json",
                    },
                    body: JSON.stringify({ key, email })
                });
                
                const data = await response.json();
                
                if (!data.success) {
                    throw new Error(data.message || "验证失败");
                }
                
                // 保存当前秘钥信息
                currentKey = key;
                currentExpiryTime = data.expiryTime;
                isAdminMode = data.isAdmin;
                isSuperAdmin = data.isSuperAdmin || false;
                isTestCard = data.isTestCard || false;
                
                // 更新绑定信息显示
                updateBindInfo(data.bindCount, data.maxBind, data.remainingBinds);
                
                if (data.isAdmin) {
                    // 管理员模式
                    if (data.needsChoice) {
                        // 需要选择进入用户还是管理面板
                        document.getElementById('adminChoice').style.display = 'block';
                        document.getElementById('keyForm').style.display = 'none';
                        updateStatus(data.message, false);
                        logAction("管理员验证", "管理员模式选择", 'admin');
                        showToast('管理员模式验证成功', 'success');
                        return;
                    }
                    
                    // 直接进入管理员模式
                    document.getElementById('toggleAdminModeBtn').style.display = 'block';
                    updateStatus(data.message, false);
                    switchSection('menuButtons', ['keyForm', 'loginForm']);
                    showToast(`${isSuperAdmin ? '超级' : ''}管理员登录成功`, 'success');
                    logAction("管理员登录", `${isSuperAdmin ? '超级' : ''}管理员模式启用`, 'admin');
                    
                } else {
                    // 普通用户模式
                    updateExpiryDisplay(data.expiryTime, data.durationHours, data.cardType);
                    
                    if (data.isEmailBound && email) {
                        updateStatus(`邮箱 ${email} 已绑定此秘钥，可以直接登录！`, false);
                    } else if (data.remainingBinds <= 0) {
                        updateStatus("秘钥绑定已满！但已绑定的账号仍可登录。", true);
                    } else {
                        updateStatus(data.message, false);
                    }
                    
                    switchSection('loginForm', ['keyForm', 'menuButtons']);
                    showToast('秘钥验证成功', 'success');
                    logAction("秘钥验证", "秘钥验证成功", 'success');
                }
                
            } catch (error) {
                updateStatus(`验证失败：${error.message}`, true);
                showToast(`验证失败：${error.message}`, 'error');
                logAction("秘钥验证", `验证失败：${error.message}`, 'error');
            } finally {
                setButtonLoading('btnCheckKey', false);
            }
        }

        async function handleLogin() {
            const email = document.getElementById('email').value.trim();
            const password = document.getElementById('password').value;

            if (!email || !password) {
                updateStatus("请输入邮箱和密码！", true);
                showToast("请输入邮箱和密码！", 'error');
                return;
            }
            
            setButtonLoading('btnLogin', true);
            updateStatus("正在登录...", false);

            try {
                // 准备请求数据 - 确保传递 currentKey
                const requestData = {
                    email: email,
                    password: password,
                    key: currentKey  // 确保传递当前秘钥
                };

                const response = await fetch(`${API_BASE_URL}/login`, {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json",
                    },
                    body: JSON.stringify(requestData)
                });
                
                const data = await response.json();
                
                if (!data.success) {
                    throw new Error(data.message || "登录失败");
                }

                currentToken = data.data.idToken;
                currentUser = data.data.email;
                
                // 保存到本地存储
                saveAuthToStorage(currentKey, currentToken, currentExpiryTime, currentUser);

                updateStatus("登录成功！进入功能菜单。", false);
                switchSection('menuButtons', ['keyForm', 'loginForm']);
                showToast('登录成功！', 'success');

                logAction("用户登录", `用户 ${currentUser} 登录成功`, 'success');

            } catch (error) {
                updateStatus(`登录失败：${error.message}`, true);
                showToast(`登录失败：${error.message}`, 'error');
                logAction("用户登录", `登录失败：${error.message}`, 'error');
            } finally {
                setButtonLoading('btnLogin', false);
            }
        }

        async function handleKingRank() {
            if (!currentToken || !currentKey) {
                updateStatus("请先登录！", true);
                handleLogout(true);
                return;
            }

            logAction("等级设置", "开始尝试设置国王等级...", 'info');
            updateStatus("正在尝试设置国王等级...", false);
            setButtonLoading('btnKingRank', true);

            try {
                const response = await fetch(`${API_BASE_URL}/king-rank`, {
                    method: "POST",
                    headers: { 
                        "Authorization": `Bearer ${currentToken}`
                    }
                });
                
                const data = await response.json();
                
                if (!data.success) {
                    throw new Error(data.message || "设置失败");
                }

                logAction("等级设置", "国王等级设置成功", 'success');
                updateStatus(data.message, false);
                showToast('国王等级设置成功！', 'success');

            } catch (error) {
                updateStatus(`等级设置失败：${error.message}`, true);
                showToast(`等级设置失败：${error.message}`, 'error');
                logAction("等级设置", `设置失败: ${error.message}`, 'error');
            } finally {
                setButtonLoading('btnKingRank', false);
            }
        }

        async function handleChangeEmail() {
            if (!currentToken || !currentKey) {
                updateStatus("请先登录！", true);
                handleLogout(true);
                return;
            }

            if (isTestCard) {
                alert(translations[currentLanguage].testCardEmailWarning);
                return;
            }

            const newEmail = prompt(`请输入新的邮箱地址（当前: ${currentUser}）：`);
            if (!newEmail) return;

            logAction("修改邮箱", `正在尝试修改邮箱至 ${newEmail}...`, 'info');
            updateStatus("正在修改邮箱...", false);

            try {
                const response = await fetch(`${API_BASE_URL}/change-email`, {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json",
                    },
                    body: JSON.stringify({
                        idToken: currentToken,
                        newEmail: newEmail,
                        oldEmail: currentUser,
                        key: currentKey
                    })
                });
                
                const data = await response.json();
                
                if (!data.success) {
                    throw new Error(data.message || "修改失败");
                }

                currentToken = data.data.idToken;
                const oldUser = currentUser;
                currentUser = data.data.email;
                saveAuthToStorage(currentKey, currentToken, currentExpiryTime, currentUser);

                logAction("修改邮箱", `成功从 ${oldUser} 修改为 ${currentUser}`, 'success');
                updateStatus(`邮箱修改成功！新邮箱: ${currentUser}`, false);
                showToast('邮箱修改成功！', 'success');

            } catch (error) {
                updateStatus(`修改失败：${error.message}`, true);
                showToast(`修改失败：${error.message}`, 'error');
                logAction("修改邮箱", `修改失败: ${error.message}`, 'error');
            }
        }

        async function handleChangePassword() {
            if (!currentToken || !currentKey) {
                updateStatus("请先登录！", true);
                handleLogout(true);
                return;
            }

            if (isTestCard) {
                alert(translations[currentLanguage].testCardPasswordWarning);
                return;
            }

            const newPassword = prompt("请输入新密码（至少6位）：");
            if (!newPassword) return;
            
            if (newPassword.length < 6) {
                updateStatus("新密码长度不能少于6位！", true);
                showToast("新密码长度不能少于6位！", 'error');
                return;
            }

            logAction("修改密码", "正在尝试修改密码...", 'info');
            updateStatus("正在修改密码...", false);

            try {
                const response = await fetch(`${API_BASE_URL}/change-password`, {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json",
                    },
                    body: JSON.stringify({
                        idToken: currentToken,
                        newPassword: newPassword,
                        email: currentUser,
                        key: currentKey
                    })
                });
                
                const data = await response.json();
                
                if (!data.success) {
                    throw new Error(data.message || "修改失败");
                }

                currentToken = data.data.idToken;
                saveAuthToStorage(currentKey, currentToken, currentExpiryTime, currentUser);

                logAction("修改密码", "密码修改成功", 'success');
                updateStatus("密码修改成功！", false);
                showToast('密码修改成功！', 'success');

            } catch (error) {
                updateStatus(`修改失败：${error.message}`, true);
                showToast(`修改失败：${error.message}`, 'error');
                logAction("修改密码", `修改失败: ${error.message}`, 'error');
            }
        }

        // ==================== 辅助函数 ====================
        function switchSection(showId, hideIds) {
            document.getElementById(showId).style.display = 'block';
            hideIds.forEach(id => {
                document.getElementById(id).style.display = 'none';
            });
            
            if (showId !== 'keyForm') {
                document.getElementById('navButtons').style.display = 'block';
            } else {
                document.getElementById('navButtons').style.display = 'none';
            }
        }

        function updateBindInfo(bindCount, maxBind, remainingBinds) {
            const bindInfoEl = document.getElementById('bindInfo');
            if (bindCount !== undefined && maxBind !== undefined && remainingBinds !== undefined) {
                const bindText = `当前绑定: ${bindCount}/${maxBind} | 剩余: ${remainingBinds}`;
                bindInfoEl.textContent = bindText;
                bindInfoEl.style.display = 'block';
                
                if (remainingBinds <= 2) {
                    bindInfoEl.style.background = 'linear-gradient(135deg, rgba(255, 0, 85, 0.2), rgba(255, 77, 0, 0.2))';
                    bindInfoEl.style.borderColor = 'rgba(255, 0, 85, 0.4)';
                    bindInfoEl.style.color = '#ff6680';
                }
            } else {
                bindInfoEl.style.display = 'none';
            }
        }

        function updateExpiryDisplay(expiryTime, durationHours, cardType) {
            const displayEl = document.getElementById('expiryDisplay');
            if (!expiryTime) {
                displayEl.innerHTML = '';
                return;
            }
            
            let vipLevel = "";
            let vipColor = "";
            
            if (isTestCard) {
                vipLevel = "测试卡用户";
                vipColor = "var(--cyber-orange)";
            } else if (cardType === 'DIAMOND_EXCLUSIVE') {
                vipLevel = "💎 钻石VIP";
                vipColor = "var(--cyber-blue)";
            } else if (durationHours >= 30 * 24) {
                vipLevel = "⚜️ 铂金VIP";
                vipColor = "#e5e4e2";
            } else if (durationHours >= 7 * 24) {
                vipLevel = "⭐ 黄金VIP";
                vipColor = "#ffd700";
            } else if (durationHours >= 24) {
                vipLevel = "✨ 白银VIP";
                vipColor = "#c0c0c0";
            } else {
                vipLevel = "🔥 青铜VIP";
                vipColor = "#cd7f32";
            }
            
            displayEl.innerHTML = `
                <div style="color: ${vipColor}; margin-bottom: 15px; font-weight: 700; font-size: 18px;">
                    ${vipLevel}
                </div>
                <div class="blinking-expiry">
                    <i class="fas fa-clock"></i> 秘钥将于 ${formatDate(expiryTime)} 到期
                </div>
                <div style="margin-top: 10px; color: rgba(255,255,255,0.7); font-size: 14px;">
                    <i class="fas fa-hourglass-half"></i> ${formatTimeLeft(expiryTime)}
                </div>
            `;
        }

        function saveAuthToStorage(key, token, expiry, user) {
            localStorage.setItem('accessKey', key);
            localStorage.setItem('idToken', token);
            localStorage.setItem('expiryTime', expiry);
            localStorage.setItem('currentUser', user);
            localStorage.setItem('currentLanguage', currentLanguage);
        }

        function loadAuthFromStorage() {
            currentKey = localStorage.getItem('accessKey');
            currentToken = localStorage.getItem('idToken');
            currentExpiryTime = localStorage.getItem('expiryTime');
            currentUser = localStorage.getItem('currentUser');
            const savedLang = localStorage.getItem('currentLanguage');
            if (savedLang) {
                currentLanguage = savedLang;
                document.getElementById('languageSelect').value = currentLanguage;
            }
            return currentKey && currentToken;
        }

        // ==================== 管理员功能 ====================
        function enterAdminPanel() {
            document.getElementById('adminChoice').style.display = 'none';
            document.getElementById('menuButtons').style.display = 'block';
            document.getElementById('toggleAdminModeBtn').style.display = 'block';
            updateStatus("已进入管理员模式，点击上方按钮切换管理面板", false);
            logAction("管理员模式", "进入管理员模式", 'admin');
        }

        function enterUserPanel() {
            document.getElementById('adminChoice').style.display = 'none';
            document.getElementById('loginForm').style.display = 'block';
            updateStatus("请登录您的游戏账号使用功能", false);
            logAction("管理员模式", "选择用户功能", 'admin');
        }

        function toggleAdminMode() {
            if (!isAdminMode) return;

            const isViewingAdmin = document.getElementById('adminPanel').style.display === 'block';
            
            if (isViewingAdmin) {
                document.getElementById('adminPanel').style.display = 'none';
                document.getElementById('menuButtons').style.display = 'block';
                updateStatus("已退出管理员面板", false);
                logAction("管理员面板", "退出管理员面板", 'admin');
            } else {
                document.getElementById('menuButtons').style.display = 'none';
                document.getElementById('adminPanel').style.display = 'block';
                updateStatus("管理员面板已开启", false);
                fetchKeys();
                logAction("管理员面板", "进入管理员面板", 'admin');
            }
        }

        function toggleTestCardOptions() {
            const isTestCard = document.getElementById('isTestCard').checked;
            const normalOptions = document.getElementById('normalKeyOptions');
            
            if (isTestCard) {
                normalOptions.style.display = 'none';
                document.getElementById('newKeyDuration').value = 1;
                document.getElementById('newKeyMaxBind').value = 1;
            } else {
                normalOptions.style.display = 'block';
                document.getElementById('newKeyDuration').value = 24;
                document.getElementById('newKeyMaxBind').value = 3;
            }
        }

        function switchTab(tabName) {
            currentTab = tabName;
            
            // 更新标签按钮状态
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            
            // 重新渲染密钥列表
            renderKeysList();
        }

        // ==================== 事件监听 ====================
        document.addEventListener("DOMContentLoaded", () => {
            // 创建数据流效果
            createDataStream();
            
            // 初始化
            const hasStored = loadAuthFromStorage();
            
            if (hasStored && currentKey) {
                updateStatus("发现上次登录状态，正在重新验证...", false);
                document.getElementById('accessKey').value = currentKey;
                handleCheckKey(currentKey);
            } else {
                switchSection('keyForm', ['loginForm', 'menuButtons']);
                updateStatus("系统就绪，请输入秘钥验证", false);
            }

            // 键盘事件
            document.getElementById('accessKey').addEventListener('keydown', (e) => {
                if (e.key === 'Enter') handleCheckKey();
            });
            
            const passwordInput = document.getElementById('password');
            if (passwordInput) {
                passwordInput.addEventListener('keydown', (e) => {
                    if (e.key === 'Enter') handleLogin();
                });
            }
        });

        // 语言切换
        function changeLanguage(lang) {
            currentLanguage = lang;
            localStorage.setItem('currentLanguage', lang);
            
            // 更新界面文字
            const t = translations[lang];
            document.getElementById('statusMessage').innerHTML = `<i class="fas fa-microchip"></i> ${t.statusReady}`;
            document.getElementById('checkKeyText').innerHTML = `<i class="fas fa-shield-alt"></i> ${t.btnCheckKey}`;
            document.getElementById('loginText').innerHTML = `<i class="fas fa-sign-in-alt"></i> ${t.btnLogin}`;
            document.getElementById('addKeyText').innerHTML = t.btnAddKey;
            
            logAction("语言切换", `切换到 ${lang === 'zh-CN' ? '中文简体' : lang === 'zh-TW' ? '中文繁體' : 'English'}`, 'info');
            
            // 更新密钥列表标题
            if (isAdminMode) {
                document.getElementById('adminTitle').innerHTML = `<i class="fas fa-key"></i> ${t.adminTitle}`;
            }
        }

        // 导航功能
        function handleSwitchAccount() {
            currentUser = null;
            currentToken = null;
            localStorage.removeItem('idToken');
            localStorage.removeItem('currentUser');
            
            if (isAdminMode) {
                switchSection('loginForm', ['menuButtons', 'adminPanel']);
                updateStatus("请登录新的游戏账号", false);
            } else {
                switchSection('loginForm', ['menuButtons']);
                updateStatus("请登录新的游戏账号", false);
            }
            
            logAction("切换账号", "切换到新账号登录", 'info');
            showToast('已切换到新账号登录', 'info');
        }

        function handleSwitchKey() {
            handleLogout(true);
            updateStatus("请输入新的秘钥", false);
            logAction("切换秘钥", "切换到新秘钥输入", 'info');
            showToast('请重新输入秘钥', 'info');
        }

        function handleReturnHome() {
            if (isAdminMode) {
                document.getElementById('adminPanel').style.display = 'none';
                switchSection('menuButtons', ['keyForm', 'loginForm']);
            } else {
                switchSection('menuButtons', ['keyForm', 'loginForm']);
            }
            updateStatus("已返回主菜单", false);
            logAction("导航", "返回主菜单", 'info');
        }

        function handleLogout(silent = false) {
            localStorage.removeItem('accessKey');
            localStorage.removeItem('idToken');
            localStorage.removeItem('expiryTime');
            localStorage.removeItem('currentUser');
            
            currentUser = null;
            currentToken = null;
            currentKey = null;
            isAdminMode = false;
            isSuperAdmin = false;
            isTestCard = false;

            document.getElementById('accessKey').value = '';
            const emailInput = document.getElementById('email');
            const passwordInput = document.getElementById('password');
            if (emailInput) emailInput.value = '';
            if (passwordInput) passwordInput.value = '';
            document.getElementById('toggleAdminModeBtn').style.display = 'none';
            document.getElementById('adminPanel').style.display = 'none';
            updateBindInfo();
            
            switchSection('keyForm', ['loginForm', 'menuButtons']);

            if (!silent) {
                updateStatus("已成功退出登录，请重新验证秘钥", false);
                logAction("退出", "用户已退出登录", 'info');
                showToast('已退出登录', 'info');
            }
        }

        // ==================== 密钥管理功能 ====================
        async function fetchKeys() {
            if (!isAdminMode) return;
            
            updateStatus("正在获取秘钥列表...", false);
            setButtonLoading('btnRefresh', true);
            logAction("秘钥管理", "获取秘钥列表", 'info');

            try {
                const response = await fetch(`${API_BASE_URL}/admin/keys?key=${currentKey}`);
                const data = await response.json();
                
                if (!data.success) {
                    throw new Error(data.message || "获取失败");
                }

                // 保存密钥数据
                window.keysData = data.keys;
                
                // 渲染密钥列表
                renderKeysList();
                
                // 更新统计数据
                updateStats(data.keys);
                
                updateStatus("成功获取秘钥信息", false);
                logAction("秘钥管理", "获取列表成功", 'success');
                showToast('密钥列表已更新', 'success');

            } catch (error) {
                updateStatus(`获取列表失败：${error.message}`, true);
                showToast(`获取列表失败：${error.message}`, 'error');
                logAction("秘钥管理", `获取列表失败：${error.message}`, 'error');
            } finally {
                setButtonLoading('btnRefresh', false);
            }
        }

        function updateStats(keysData) {
            let total = 0;
            let active = 0;
            let testCards = 0;
            
            // 统计所有密钥
            const allKeys = [
                ...keysData.telegram || [],
                ...keysData.superAdmin || [],
                ...Object.values(keysData.normalAdmins || {}).flatMap(admin => admin.keys || [])
            ];
            
            total = allKeys.length;
            active = allKeys.filter(k => k.status === 'active' && new Date(k.expiryTime) > new Date()).length;
            testCards = allKeys.filter(k => k.isTestCard).length;
            
            document.getElementById('totalKeys').textContent = total;
            document.getElementById('activeKeys').textContent = active;
            document.getElementById('testCards').textContent = testCards;
        }

        function renderKeysList() {
            const container = document.getElementById('keyTablesContainer');
            
            if (!window.keysData) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-icon">
                            <i class="fas fa-database"></i>
                        </div>
                        <div>${translations[currentLanguage].noKeys}</div>
                        <button class="cyber-button" onclick="fetchKeys()" style="margin-top: 20px;">
                            <i class="fas fa-sync-alt"></i> 加载密钥
                        </button>
                    </div>
                `;
                return;
            }

            let html = '';
            
            // Telegram机器人生成的秘钥
            if (window.keysData.telegram && window.keysData.telegram.length > 0) {
                const filteredKeys = filterKeysByTab(window.keysData.telegram);
                if (filteredKeys.length > 0) {
                    html += createKeyTable('Telegram机器人', filteredKeys);
                }
            }
            
            // 超级管理人生成的秘钥
            if (window.keysData.superAdmin && window.keysData.superAdmin.length > 0) {
                const filteredKeys = filterKeysByTab(window.keysData.superAdmin);
                if (filteredKeys.length > 0) {
                    html += createKeyTable('超级管理员', filteredKeys);
                }
            }
            
            // 普通管理人生成的秘钥
            if (window.keysData.normalAdmins) {
                Object.entries(window.keysData.normalAdmins).forEach(([adminKey, adminData]) => {
                    const filteredKeys = filterKeysByTab(adminData.keys || []);
                    if (filteredKeys.length > 0) {
                        html += createKeyTable(`${adminData.adminName} (${adminKey})`, filteredKeys, adminKey);
                    }
                });
            }
            
            if (!html) {
                html = `
                    <div class="empty-state">
                        <div class="empty-icon">
                            <i class="fas fa-search"></i>
                        </div>
                        <div>${translations[currentLanguage].noKeys}</div>
                    </div>
                `;
            }
            
            container.innerHTML = html;
        }

        function filterKeysByTab(keys) {
            switch(currentTab) {
                case 'testCardsTab':
                    return keys.filter(k => k.isTestCard);
                case 'adminKeys':
                    return keys.filter(k => k.isAdmin || k.isSuperAdmin);
                case 'allKeys':
                default:
                    return keys;
            }
        }

        function createKeyTable(title, keys, adminKey = null) {
            return `
                <div class="key-table-container">
                    <div class="key-table-title">
                        <i class="fas fa-list"></i> ${title}
                        <span style="color: rgba(255,255,255,0.5); font-size: 14px; margin-left: 10px;">
                            (${keys.length} 个密钥)
                        </span>
                    </div>
                    ${keys.map(key => createKeyItem(key, adminKey)).join('')}
                </div>
            `;
        }

        function createKeyItem(keyData, adminKey) {
            const isExpired = new Date(keyData.expiryTime) < new Date();
            const status = isExpired ? 'expired' : keyData.status;
            const badgeClass = keyData.isAdmin ? 'badge-admin' : 
                              keyData.isTestCard ? 'badge-test' :
                              status === 'active' ? 'badge-active' : 'badge-expired';
            
            const badgeText = keyData.isAdmin ? '管理员' : 
                             keyData.isTestCard ? '测试卡' :
                             status === 'active' ? '激活' : '过期';
            
            return `
                <div class="key-item" id="key-item-${keyData.key}">
                    <div class="key-info-row">
                        <div class="key-value" title="${keyData.key}">
                            ${keyData.key}
                        </div>
                        <div class="key-meta">
                            <span class="key-badge ${badgeClass}">
                                ${badgeText}
                            </span>
                            ${keyData.isSuperAdmin ? '<span class="key-badge badge-admin">超级</span>' : ''}
                        </div>
                    </div>
                    
                    <div class="key-details">
                        <div class="detail-item">
                            <div class="detail-label">过期时间</div>
                            <div>${formatDate(keyData.expiryTime)}</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">绑定状态</div>
                            <div>${keyData.boundEmails?.length || 0}/${keyData.maxBind}</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">备注</div>
                            <div>${keyData.remark || '无'}</div>
                        </div>
                        ${adminKey ? `
                            <div class="detail-item">
                                <div class="detail-label">管理员</div>
                                <div>${keyData.addedByName || '未知'}</div>
                            </div>
                        ` : ''}
                    </div>
                    
                    <div class="key-actions">
                        <button class="action-btn copy" onclick="copyKey('${keyData.key}')">
                            <i class="fas fa-copy"></i> 复制
                        </button>
                        ${canDeleteKey(keyData, adminKey) ? `
                            <button class="action-btn delete" onclick="deleteKey('${keyData.key}')">
                                <i class="fas fa-trash"></i> 删除
                            </button>
                        ` : ''}
                    </div>
                </div>
            `;
        }

        function canDeleteKey(keyData, adminKey) {
            // 超级管理员可以删除所有密钥
            if (isSuperAdmin) return true;
            
            // 普通管理员只能删除自己生成的密钥
            if (adminKey && keyData.addedBy === adminKey) return true;
            
            return false;
        }

        async function copyKey(key) {
            copyToClipboard(key);
        }

        async function deleteKey(key) {
            if (!confirm(translations[currentLanguage].confirmDelete)) return;
            
            try {
                setButtonLoading('btnRefresh', true);
                
                const response = await fetch(`${API_BASE_URL}/admin/keys?key=${currentKey}&keyToDelete=${key}`, {
                    method: 'DELETE'
                });
                
                const data = await response.json();
                
                if (!data.success) {
                    throw new Error(data.message || "删除失败");
                }
                
                // 从界面移除该密钥
                const keyItem = document.getElementById(`key-item-${key}`);
                if (keyItem) {
                    keyItem.style.opacity = '0.5';
                    keyItem.style.transform = 'translateX(-100px)';
                    setTimeout(() => {
                        keyItem.remove();
                        fetchKeys(); // 重新获取列表
                    }, 300);
                }
                
                showToast(translations[currentLanguage].deleteSuccess, 'success');
                logAction("密钥删除", `删除密钥: ${key}`, 'success');
                
            } catch (error) {
                console.error('删除密钥错误:', error);
                showToast(`删除失败: ${error.message}`, 'error');
                logAction("密钥删除", `删除失败: ${error.message}`, 'error');
            } finally {
                setButtonLoading('btnRefresh', false);
            }
        }

        async function handleAddKey() {
            if (!isAdminMode) return;

            const isTestCard = document.getElementById('isTestCard').checked;
            const duration = parseInt(document.getElementById('newKeyDuration').value);
            const maxBind = parseInt(document.getElementById('newKeyMaxBind').value) || 3;
            const remark = document.getElementById('newKeyRemark').value.trim();

            if (!isTestCard && (isNaN(duration) || duration <= 0)) {
                showToast("请输入有效的秘钥时长 (小时)", 'error');
                return;
            }

            logAction("秘钥管理", `正在生成${isTestCard ? '测试卡' : '秘钥'}...`, 'info');
            updateStatus("正在生成并新增秘钥...", false);
            setButtonLoading('btnAddKey', true);

            try {
                const response = await fetch(`${API_BASE_URL}/admin/keys?key=${currentKey}`, {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json",
                    },
                    body: JSON.stringify({ 
                        durationHours: duration, 
                        maxBind: maxBind, 
                        remark: remark,
                        isTestCard: isTestCard 
                    })
                });
                
                const data = await response.json();
                
                if (!data.success) {
                    throw new Error(data.message || "生成失败");
                }

                const successMessage = isTestCard ? 
                    `测试卡生成成功！\n\n秘钥: ${data.key}\n时长: 1 小时\n最大绑定: 1 个账号\n备注: ${remark || '测试卡'}` :
                    `秘钥生成成功！\n\n秘钥: ${data.key}\n时长: ${duration} 小时\n最大绑定: ${maxBind} 个账号\n备注: ${remark || '无'}`;
                
                // 复制密钥到剪贴板
                copyToClipboard(data.key);
                
                alert(successMessage);
                
                // 清空表单
                document.getElementById('newKeyRemark').value = '';
                document.getElementById('isTestCard').checked = false;
                toggleTestCardOptions();
                
                logAction("秘钥管理", `成功生成${isTestCard ? '测试卡' : '秘钥'}: ${data.key}`, 'success');
                showToast(translations[currentLanguage].addKeySuccess, 'success');
                
                // 刷新列表
                fetchKeys();

            } catch (error) {
                updateStatus(`新增秘钥失败：${error.message}`, true);
                showToast(`新增秘钥失败：${error.message}`, 'error');
                logAction("秘钥管理", `新增秘钥失败：${error.message}`, 'error');
            } finally {
                setButtonLoading('btnAddKey', false);
            }
        }

        async function handleCleanupExpiredKeys() {
            if (!isAdminMode) return;
            
            if (!confirm(translations[currentLanguage].confirmCleanup)) return;

            logAction("秘钥管理", "正在清理过期秘钥...", 'info');
            updateStatus("正在清理过期秘钥...", false);
            setButtonLoading('btnCleanup', true);

            try {
                const response = await fetch(`${API_BASE_URL}/admin/cleanup-expired-keys?key=${currentKey}`, {
                    method: "POST"
                });
                
                const data = await response.json();
                
                if (!data.success) {
                    throw new Error(data.message || "清理失败");
                }

                logAction("秘钥管理", data.message, 'success');
                updateStatus(data.message, false);
                showToast(translations[currentLanguage].cleanupSuccess, 'success');
                
                fetchKeys();

            } catch (error) {
                updateStatus(`清理失败：${error.message}`, true);
                showToast(`清理失败：${error.message}`, 'error');
                logAction("秘钥管理", `清理失败: ${error.message}`, 'error');
            } finally {
                setButtonLoading('btnCleanup', false);
            }
        }
    </script>
</body>
</html>
