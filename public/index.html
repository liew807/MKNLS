<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>MKNLSå·¥å…·å¹³å°V3.0</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<style>
    * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
        -webkit-tap-highlight-color: transparent;
    }

    :root {
        --cyber-blue: #00f3ff;
        --cyber-pink: #ff00ff;
        --cyber-purple: #9d00ff;
        --cyber-green: #00ff9d;
        --cyber-yellow: #ffdd00;
        --cyber-red: #ff0055;
        --dark-bg: #0a0a0f;
        --card-bg: rgba(20, 20, 30, 0.85);
        --glow-blue: 0 0 15px rgba(0, 243, 255, 0.5);
        --glow-pink: 0 0 15px rgba(255, 0, 255, 0.5);
    }

    body {
        font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        background: var(--dark-bg);
        min-height: 100vh;
        display: flex;
        flex-direction: column;
        align-items: center;
        padding: 20px 16px;
        color: #fff;
        position: relative;
        overflow-x: hidden;
    }

    /* Cyberpunk ç½‘æ ¼èƒŒæ™¯ */
    body::before {
        content: '';
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: 
            linear-gradient(90deg, rgba(255, 0, 255, 0.03) 1px, transparent 1px),
            linear-gradient(0deg, rgba(255, 0, 255, 0.03) 1px, transparent 1px);
        background-size: 50px 50px;
        z-index: 0;
        pointer-events: none;
    }

    /* æ‰«æçº¿æ•ˆæœ */
    .scanlines {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: linear-gradient(
            to bottom,
            transparent 50%,
            rgba(0, 243, 255, 0.03) 50%
        );
        background-size: 100% 4px;
        z-index: 1;
        pointer-events: none;
        animation: scanline 10s linear infinite;
    }

    @keyframes scanline {
        0% { transform: translateY(0); }
        100% { transform: translateY(100%); }
    }

    /* æµå…‰è¾¹æ¡†æ•ˆæœ */
    .cyber-border {
        position: relative;
        border-radius: 20px;
        overflow: hidden;
        background: var(--card-bg);
        backdrop-filter: blur(20px);
        border: 1px solid rgba(255, 255, 255, 0.1);
    }

    .cyber-border::before {
        content: '';
        position: absolute;
        top: -2px;
        left: -2px;
        right: -2px;
        bottom: -2px;
        background: linear-gradient(
            45deg,
            var(--cyber-blue),
            var(--cyber-pink),
            var(--cyber-purple),
            var(--cyber-green)
        );
        border-radius: 22px;
        z-index: -1;
        animation: borderGlow 4s linear infinite;
        background-size: 400% 400%;
        filter: blur(10px);
        opacity: 0.7;
    }

    @keyframes borderGlow {
        0%, 100% { background-position: 0% 50%; }
        50% { background-position: 100% 50%; }
    }

    /* ä¸»å®¹å™¨ */
    .main-container {
        width: 100%;
        max-width: 480px;
        position: relative;
        z-index: 2;
        margin: 0 auto;
    }

    /* æ ‡é¢˜åŒºåŸŸ - Cyberpunké£æ ¼ */
    .cyber-header {
        text-align: center;
        padding: 30px 20px;
        margin-bottom: 30px;
        position: relative;
    }

    .main-title {
        font-size: 2.8rem;
        font-weight: 900;
        text-transform: uppercase;
        letter-spacing: 2px;
        margin-bottom: 15px;
        text-shadow: 
            0 0 10px var(--cyber-blue),
            0 0 20px var(--cyber-blue),
            0 0 30px var(--cyber-blue);
        background: linear-gradient(45deg, var(--cyber-blue), var(--cyber-pink), var(--cyber-purple));
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
        background-size: 200% 200%;
        animation: titleGlow 3s ease infinite;
    }

    @keyframes titleGlow {
        0%, 100% { background-position: 0% 50%; }
        50% { background-position: 100% 50%; }
    }

    .sub-title {
        font-size: 1.1rem;
        color: rgba(255, 255, 255, 0.7);
        letter-spacing: 8px;
        text-transform: uppercase;
        position: relative;
        display: inline-block;
        padding: 0 20px;
    }

    .sub-title::before,
    .sub-title::after {
        content: 'âœ¦';
        position: absolute;
        top: 50%;
        transform: translateY(-50%);
        color: var(--cyber-pink);
        animation: sparkle 2s ease-in-out infinite;
    }

    .sub-title::before { left: 0; }
    .sub-title::after { right: 0; }

    @keyframes sparkle {
        0%, 100% { opacity: 1; }
        50% { opacity: 0.3; }
    }

    /* å¿«æ‰‹å¿«é€Ÿå…¥å£ */
    .quick-access {
        margin-bottom: 25px;
    }

    .kuaishou-btn {
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 12px;
        width: 100%;
        padding: 18px;
        border: none;
        border-radius: 15px;
        background: linear-gradient(135deg, 
            rgba(255, 0, 92, 0.9), 
            rgba(255, 122, 0, 0.9),
            rgba(255, 215, 0, 0.9));
        color: white;
        font-size: 18px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
        text-decoration: none;
        position: relative;
        overflow: hidden;
    }

    .kuaishou-btn::before {
        content: '';
        position: absolute;
        top: -50%;
        left: -50%;
        width: 200%;
        height: 200%;
        background: linear-gradient(
            45deg,
            transparent 30%,
            rgba(255, 255, 255, 0.1) 50%,
            transparent 70%
        );
        transform: rotate(45deg);
        animation: shine 3s infinite linear;
    }

    @keyframes shine {
        0% { transform: translateX(-100%) rotate(45deg); }
        100% { transform: translateX(100%) rotate(45deg); }
    }

    .kuaishou-btn:hover {
        transform: translateY(-3px);
        box-shadow: 
            0 10px 30px rgba(255, 0, 92, 0.4),
            0 0 20px rgba(255, 122, 0, 0.3);
    }

    .kuaishou-btn i {
        font-size: 20px;
        animation: pulse 2s infinite;
    }

    @keyframes pulse {
        0%, 100% { transform: scale(1); }
        50% { transform: scale(1.1); }
    }

    /* ä¸»å¡ç‰‡ */
    .cyber-card {
        padding: 25px;
        margin-bottom: 20px;
    }

    /* çŠ¶æ€ä¿¡æ¯ - Cyberpunké£æ ¼ */
    .cyber-status {
        text-align: center;
        padding: 15px;
        border-radius: 12px;
        margin-bottom: 20px;
        font-weight: 500;
        font-size: 15px;
        min-height: 44px;
        display: flex;
        align-items: center;
        justify-content: center;
        transition: all 0.3s ease;
        background: rgba(0, 243, 255, 0.1);
        border: 1px solid rgba(0, 243, 255, 0.3);
        color: var(--cyber-blue);
        text-shadow: 0 0 10px rgba(0, 243, 255, 0.5);
        position: relative;
        overflow: hidden;
    }

    .cyber-status::before {
        content: '';
        position: absolute;
        top: 0;
        left: -100%;
        width: 100%;
        height: 100%;
        background: linear-gradient(
            90deg,
            transparent,
            rgba(0, 243, 255, 0.2),
            transparent
        );
        animation: statusGlow 2s infinite;
    }

    @keyframes statusGlow {
        0% { left: -100%; }
        100% { left: 100%; }
    }

    .cyber-status.error {
        background: rgba(255, 0, 85, 0.1);
        border: 1px solid rgba(255, 0, 85, 0.3);
        color: var(--cyber-red);
        text-shadow: 0 0 10px rgba(255, 0, 85, 0.5);
    }

    .cyber-status.success {
        background: rgba(0, 255, 157, 0.1);
        border: 1px solid rgba(0, 255, 157, 0.3);
        color: var(--cyber-green);
        text-shadow: 0 0 10px rgba(0, 255, 157, 0.5);
    }

    /* è¾“å…¥æ¡† - Cyberpunké£æ ¼ */
    .cyber-input {
        width: 100%;
        padding: 18px;
        margin-bottom: 15px;
        border: 2px solid rgba(0, 243, 255, 0.3);
        border-radius: 12px;
        background: rgba(10, 10, 15, 0.7);
        font-size: 16px;
        transition: all 0.3s ease;
        outline: none;
        color: white;
        font-family: 'Inter', monospace;
    }

    .cyber-input:focus {
        border-color: var(--cyber-blue);
        background: rgba(10, 10, 15, 0.9);
        box-shadow: 
            0 0 15px rgba(0, 243, 255, 0.3),
            inset 0 0 10px rgba(0, 243, 255, 0.1);
    }

    .cyber-input::placeholder {
        color: rgba(255, 255, 255, 0.4);
        font-family: 'Inter', sans-serif;
    }

    /* æŒ‰é’® - Cyberpunké£æ ¼ */
    .cyber-button {
        width: 100%;
        padding: 18px;
        border: none;
        border-radius: 12px;
        background: linear-gradient(135deg, 
            rgba(0, 243, 255, 0.9), 
            rgba(157, 0, 255, 0.9));
        color: white;
        font-size: 16px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
        margin-bottom: 10px;
        position: relative;
        overflow: hidden;
        text-transform: uppercase;
        letter-spacing: 1px;
    }

    .cyber-button:hover {
        transform: translateY(-2px);
        box-shadow: 
            0 10px 25px rgba(0, 243, 255, 0.3),
            0 0 20px rgba(157, 0, 255, 0.2);
    }

    .cyber-button:active {
        transform: translateY(0);
    }

    .cyber-button.secondary {
        background: linear-gradient(135deg, 
            rgba(255, 0, 255, 0.9), 
            rgba(255, 0, 85, 0.9));
    }

    .cyber-button.success {
        background: linear-gradient(135deg, 
            rgba(0, 255, 157, 0.9), 
            rgba(0, 200, 255, 0.9));
    }

    .cyber-button.destructive {
        background: linear-gradient(135deg, 
            rgba(255, 0, 85, 0.9), 
            rgba(255, 77, 0, 0.9));
    }

    /* å¯¼èˆªæŒ‰é’®ç»„ */
    .cyber-nav-buttons {
        display: flex;
        gap: 10px;
        margin: 20px 0;
    }

    .cyber-nav-buttons button {
        flex: 1;
        padding: 14px;
        font-size: 14px;
    }

    /* ç®¡ç†é¢æ¿ */
    .cyber-admin-panel {
        border-top: 1px solid rgba(0, 243, 255, 0.3);
        padding-top: 25px;
        margin-top: 25px;
    }

    .cyber-admin-title {
        text-align: center;
        font-size: 22px;
        font-weight: 700;
        margin-bottom: 20px;
        background: linear-gradient(45deg, var(--cyber-blue), var(--cyber-pink));
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
        text-transform: uppercase;
        letter-spacing: 1px;
    }

    /* æ—¥å¿—å®¹å™¨ */
    .cyber-log-container {
        width: 100%;
        max-width: 480px;
        background: rgba(20, 20, 30, 0.7);
        backdrop-filter: blur(20px);
        border-radius: 15px;
        padding: 20px;
        border: 1px solid rgba(0, 243, 255, 0.2);
        max-height: 250px;
        overflow-y: auto;
        margin-top: 20px;
        position: relative;
    }

    .cyber-log-container::before {
        content: '';
        position: absolute;
        top: -1px;
        left: 0;
        right: 0;
        height: 2px;
        background: linear-gradient(90deg, 
            transparent, 
            var(--cyber-blue), 
            var(--cyber-pink), 
            transparent);
    }

    .cyber-log-title {
        color: white;
        font-size: 16px;
        font-weight: 600;
        margin-bottom: 15px;
        text-align: center;
        background: linear-gradient(45deg, var(--cyber-green), var(--cyber-blue));
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
        text-transform: uppercase;
        letter-spacing: 2px;
    }

    /* è¡¨æ ¼æ ·å¼ */
    .cyber-table-container {
        background: rgba(10, 10, 15, 0.7);
        border-radius: 12px;
        overflow: hidden;
        margin-top: 15px;
        border: 1px solid rgba(0, 243, 255, 0.2);
        position: relative;
    }

    .cyber-table-container::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 1px;
        background: linear-gradient(90deg, 
            transparent, 
            var(--cyber-blue), 
            transparent);
    }

    /* è¯­è¨€é€‰æ‹©å™¨ */
    .language-selector {
        position: absolute;
        top: 20px;
        right: 20px;
        z-index: 1000;
    }

    .language-dropdown {
        background: rgba(20, 20, 30, 0.9);
        border: 1px solid rgba(0, 243, 255, 0.3);
        border-radius: 8px;
        padding: 8px 12px;
        color: var(--cyber-blue);
        font-size: 14px;
        font-weight: 500;
        cursor: pointer;
        backdrop-filter: blur(10px);
        min-width: 120px;
        text-transform: uppercase;
        letter-spacing: 1px;
    }

    .language-dropdown option {
        background: var(--dark-bg);
        color: white;
    }

    /* å“åº”å¼è®¾è®¡ */
    @media (max-width: 480px) {
        body {
            padding: 15px 12px;
        }
        
        .main-title {
            font-size: 2.2rem;
        }
        
        .sub-title {
            font-size: 0.9rem;
            letter-spacing: 4px;
        }
        
        .cyber-card {
            padding: 20px;
        }
        
        .cyber-input {
            padding: 15px;
            font-size: 15px;
        }
        
        .cyber-button {
            padding: 15px;
            font-size: 15px;
        }
        
        .language-selector {
            position: relative;
            top: 0;
            right: 0;
            margin: 0 auto 15px;
            display: flex;
            justify-content: center;
        }
        
        .language-dropdown {
            width: 140px;
        }
    }

    /* æ»šåŠ¨æ¡ç¾åŒ– */
    ::-webkit-scrollbar {
        width: 8px;
    }

    ::-webkit-scrollbar-track {
        background: rgba(20, 20, 30, 0.5);
        border-radius: 4px;
    }

    ::-webkit-scrollbar-thumb {
        background: linear-gradient(45deg, var(--cyber-blue), var(--cyber-purple));
        border-radius: 4px;
    }

    ::-webkit-scrollbar-thumb:hover {
        background: linear-gradient(45deg, var(--cyber-pink), var(--cyber-red));
    }

    /* åŠ è½½åŠ¨ç”» */
    .cyber-spinner {
        display: inline-block;
        width: 20px;
        height: 20px;
        border: 3px solid rgba(0, 243, 255, 0.3);
        border-radius: 50%;
        border-top-color: var(--cyber-blue);
        animation: cyberSpin 1s linear infinite;
        margin-right: 8px;
    }

    @keyframes cyberSpin {
        to { transform: rotate(360deg); }
    }

    /* ç‰¹æ•ˆæ–‡å­— */
    .glitch-text {
        position: relative;
        animation: glitch 5s infinite;
    }

    @keyframes glitch {
        0%, 100% { transform: translate(0); }
        1% { transform: translate(-2px, 2px); }
        2% { transform: translate(2px, -2px); }
        3% { transform: translate(-2px, -2px); }
        4% { transform: translate(2px, 2px); }
        5% { transform: translate(0); }
    }

    /* ç”µé‡æ¡æ•ˆæœ */
    .power-bar {
        width: 100%;
        height: 4px;
        background: rgba(255, 255, 255, 0.1);
        border-radius: 2px;
        margin: 10px 0;
        overflow: hidden;
        position: relative;
    }

    .power-fill {
        height: 100%;
        background: linear-gradient(90deg, var(--cyber-green), var(--cyber-blue));
        border-radius: 2px;
        animation: powerFlow 3s ease-in-out infinite;
    }

    @keyframes powerFlow {
        0%, 100% { width: 30%; }
        50% { width: 80%; }
    }
</style>
</head>
<body>
    <!-- æ‰«æçº¿æ•ˆæœ -->
    <div class="scanlines"></div>

    <!-- è¯­è¨€é€‰æ‹©å™¨ -->
    <div class="language-selector">
        <select id="languageSelect" class="language-dropdown" onchange="changeLanguage(this.value)">
            <option value="zh-CN">ä¸­æ–‡ç®€ä½“</option>
            <option value="zh-TW">ä¸­æ–‡ç¹é«”</option>
            <option value="en">English</option>
        </select>
    </div>

    <div class="main-container">
        <!-- æ ‡é¢˜åŒºåŸŸ -->
        <div class="cyber-header">
            <h1 class="main-title glitch-text">MKNLSå·¥å…·å¹³å°3.0</h1>
            <div class="sub-title">CPM MKNLS</div>
            <div class="power-bar">
                <div class="power-fill"></div>
            </div>
        </div>

        <!-- å¿«æ‰‹å¿«é€Ÿå…¥å£ -->
        <div class="quick-access">
            <a href="https://v.kuaishou.com/n5k2Q5FF" target="_blank" class="kuaishou-btn">
                <i class="fas fa-bolt"></i>
                å¿«æ‰‹è”ç³»Jack
                <i class="fas fa-external-link-alt"></i>
            </a>
        </div>

        <!-- TelegramæŒ‰é’® -->
        <div style="margin-bottom: 20px;">
            <a href="https://t.me/cpmMKNLS" target="_blank" class="kuaishou-btn" style="background: linear-gradient(135deg, rgba(0, 136, 204, 0.9), rgba(52, 170, 223, 0.9));">
                <i class="fab fa-telegram"></i>
                åŠ å…¥MKNLS Telegramé¢‘é“
            </a>
        </div>

        <!-- ä¸»åŠŸèƒ½å¡ç‰‡ -->
        <div class="cyber-border cyber-card">
            <!-- æ‚¨çš„åŸæœ‰ä»£ç ä»è¿™é‡Œå¼€å§‹ -->
            <div id="statusMessage" class="cyber-status">ç³»ç»Ÿå°±ç»ªï¼Œè¯·éªŒè¯ç§˜é’¥</div>

            <div id="navButtons" style="display: none;">
                <div class="cyber-nav-buttons">
                    <button class="cyber-button secondary" onclick="handleReturnHome()" id="btnHome">ğŸ  é¦–é¡µ</button>
                    <button class="cyber-button secondary" onclick="handleSwitchAccount()" id="btnSwitchAccount">ğŸ”„ åˆ‡æ¢è´¦å·</button>
                    <button class="cyber-button secondary" onclick="handleSwitchKey()" id="btnSwitchKey">ğŸ”‘ åˆ‡æ¢ç§˜é’¥</button>
                </div>
            </div>

            <button id="toggleAdminModeBtn" style="display: none;" class="cyber-button secondary" onclick="toggleAdminMode()" id="btnToggleAdmin">åˆ‡æ¢ç®¡ç†å‘˜æ¨¡å¼</button>
            
            <div id="adminChoice" style="display: none;">
                <div class="cyber-status">è¯·é€‰æ‹©æ‚¨è¦è¿›å…¥çš„æ¨¡å¼</div>
                <button class="cyber-button" onclick="enterAdminPanel()" id="btnEnterAdmin">è¿›å…¥ç®¡ç†å‘˜é¢æ¿</button>
                <button class="cyber-button secondary" onclick="enterUserPanel()" id="btnEnterUser">è¿›å…¥ç”¨æˆ·åŠŸèƒ½</button>
            </div>

            <div id="keyForm">
                <div style="text-align: center; margin-bottom: 15px; color: rgba(255,255,255,0.7); font-size: 14px;">
                    <i class="fas fa-key"></i> ç§˜é’¥è¯· Facebookæœç´¢GH Treeè·å–
                </div>
                <input type="text" id="accessKey" class="cyber-input" placeholder="è¾“å…¥è®¿é—®ç§˜é’¥" maxlength="15">
                <div id="bindInfo" style="text-align: center; margin: 10px 0; padding: 10px; background: rgba(255,149,0,0.1); border-radius: 8px; border: 1px solid rgba(255,149,0,0.3); color: #FF9500; display: none;"></div>
                <button class="cyber-button" onclick="handleCheckKey()" id="btnCheckKey">
                    <span id="checkKeyText">éªŒè¯ç§˜é’¥</span>
                </button>
            </div>

            <div id="loginForm" style="display: none;">
                <div id="expiryDisplay" style="text-align: center; margin: 15px 0; padding: 12px; background: rgba(0,243,255,0.1); border-radius: 10px; border: 1px solid rgba(0,243,255,0.3); color: var(--cyber-blue);"></div>
                <input type="email" id="email" class="cyber-input" placeholder="è¾“å…¥æ‚¨çš„é‚®ç®±">
                <input type="password" id="password" class="cyber-input" placeholder="è¾“å…¥æ‚¨çš„å¯†ç ">
                <button class="cyber-button success" onclick="handleLogin()" id="btnLogin">
                    <span id="loginText">ç™»å½•</span>
                </button>
            </div>

            <div id="menuButtons" style="display: none;">
                <button class="cyber-button" onclick="handleKingRank()" id="btnKingRank">
                    <i class="fas fa-crown"></i> ä¸€é”®ä¿®æ”¹ä¸ºå›½ç‹ç­‰çº§
                </button>
                <button class="cyber-button secondary" id="btnChangeEmail" onclick="handleChangeEmail()">
                    <i class="fas fa-envelope"></i> ä¿®æ”¹é‚®ç®±
                </button>
                <button class="cyber-button secondary" id="btnChangePassword" onclick="handleChangePassword()">
                    <i class="fas fa-lock"></i> ä¿®æ”¹å¯†ç 
                </button>
            </div>
            
            <div id="adminPanel" class="cyber-admin-panel" style="display: none;">
                <h4 class="cyber-admin-title">
                    ğŸ”‘ ç§˜é’¥ç®¡ç†ä¸­å¿ƒ ğŸ”‘
                    <span id="adminLevelBadge" style="background: linear-gradient(45deg, var(--cyber-pink), var(--cyber-purple)); color: white; padding: 4px 12px; border-radius: 20px; font-size: 12px; margin-left: 10px;"></span>
                </h4>

                <div class="add-key-form">
                    <div style="background: rgba(255,0,85,0.1); padding: 15px; border-radius: 10px; margin-bottom: 15px; border: 1px solid rgba(255,0,85,0.3);">
                        <label style="color: var(--cyber-red); display: flex; align-items: center; gap: 10px;">
                            <input type="checkbox" id="isTestCard" onchange="toggleTestCardOptions()" style="transform: scale(1.3);">
                            <span style="font-weight: 600;">ç”Ÿæˆæµ‹è¯•å¡</span>
                        </label>
                        <div style="color: rgba(255,255,255,0.6); font-size: 12px; margin-top: 5px; margin-left: 30px;">
                            1å°æ—¶æœ‰æ•ˆæœŸï¼Œä»…é™1ä¸ªè´¦å·ï¼Œä»…æ”¯æŒè§£é”æˆå°±åŠŸèƒ½
                        </div>
                    </div>

                    <div id="normalKeyOptions">
                        <input type="number" id="newKeyDuration" class="cyber-input" placeholder="ç§˜é’¥æ—¶é•¿ (å°æ—¶)" value="24" min="1">
                        <input type="number" id="newKeyMaxBind" class="cyber-input" placeholder="æœ€å¤§ç»‘å®šæ•°é‡" value="3" min="1">
                    </div>
                    
                    <input type="text" id="newKeyRemark" class="cyber-input" placeholder="å¤‡æ³¨ (å¦‚: æœˆå¡/æµ‹è¯•å¡)">
                    <button class="cyber-button success" onclick="handleAddKey()" id="btnAddKey">
                        <i class="fas fa-plus"></i> <span id="addKeyText">ç”Ÿæˆæ–°ç§˜é’¥</span>
                    </button>
                </div>

                <div class="cyber-nav-buttons" style="margin: 20px 0;">
                    <button class="cyber-button secondary" onclick="fetchKeys()" id="btnRefresh">
                        <i class="fas fa-sync-alt"></i> åˆ·æ–°åˆ—è¡¨
                    </button>
                    <button class="cyber-button destructive" onclick="handleCleanupExpiredKeys()" id="btnCleanup">
                        <i class="fas fa-trash"></i> æ¸…ç†è¿‡æœŸ
                    </button>
                </div>

                <div class="cyber-table-container">
                    <!-- è¡¨æ ¼å†…å®¹ä¿æŒä¸å˜ -->
                    <details style="border-bottom: 1px solid rgba(0,243,255,0.2);">
                        <summary style="padding: 15px; background: rgba(0,243,255,0.1); cursor: pointer; font-weight: 600; color: var(--cyber-blue);">
                            <span>ğŸ¤– TGæœºå™¨äººç”Ÿæˆçš„ç§˜é’¥</span>
                            <span style="background: var(--cyber-blue); padding: 2px 8px; border-radius: 10px; font-size: 12px; margin-left: 10px;" id="tgKeyCount">0</span>
                        </summary>
                        <!-- è¡¨æ ¼å†…å®¹ -->
                    </details>
                    
                    <details style="border-bottom: 1px solid rgba(0,243,255,0.2);">
                        <summary style="padding: 15px; background: rgba(157,0,255,0.1); cursor: pointer; font-weight: 600; color: var(--cyber-purple);">
                            <span>ğŸ‘‘ è¶…çº§ç®¡ç†äººç”Ÿæˆçš„ç§˜é’¥</span>
                            <span style="background: var(--cyber-purple); padding: 2px 8px; border-radius: 10px; font-size: 12px; margin-left: 10px;" id="superAdminKeyCount">0</span>
                        </summary>
                        <!-- è¡¨æ ¼å†…å®¹ -->
                    </details>
                    
                    <div id="normalAdminCategories"></div>
                </div>
            </div>
        </div>

        <!-- æ—¥å¿—å®¹å™¨ -->
        <div class="cyber-log-container">
            <div class="cyber-log-title">
                <i class="fas fa-terminal"></i> æ“ä½œæ—¥å¿—
            </div>
            <div id="logHistory">
                <div class="ios-log-item log-info" id="systemLoaded">ç³»ç»Ÿå¯åŠ¨å®Œæˆ</div>
            </div>
        </div>
    </div>

    <!-- æ¨¡æ€æ¡† -->
    <div id="accountModal" class="ios-modal">
        <div class="ios-modal-content">
            <h3 class="ios-modal-title" id="modalAccountTitle">è´¦å·è¯¦æƒ…</h3>
            <div id="accountDetails"></div>
            <button class="cyber-button" onclick="closeAccountModal()" style="margin-top: 16px; width: 100%;" id="btnCloseModal">å…³é—­</button>
        </div>
    </div>

    <!-- åŸæœ‰çš„JavaScriptä»£ç ä¿æŒå®Œå…¨ä¸å˜ -->
    <script>
        // åŸæœ‰å®Œæ•´JavaScriptä»£ç åœ¨è¿™é‡Œ
        const API_BASE_URL = (() => {
            if (window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1') {
                return 'http://localhost:3000/api';
            }
            return '/api';
        })();

        const SUPER_ADMIN_KEY = 'cpmMKNLS';

        async function apiRequest(url, options = {}) {
            try {
                const fullUrl = url.startsWith('http') ? url : `${API_BASE_URL}${url}`;
                const response = await fetch(fullUrl, {
                    ...options,
                    headers: {
                        'Content-Type': 'application/json',
                        ...options.headers,
                    }
                });

                if (!response.ok) {
                    const errorText = await response.text();
                    throw new Error(errorText || 'è¯·æ±‚å¤±è´¥');
                }

                return await response.json();
                
            } catch (error) {
                throw error;
            }
        }

        const translations = {
            'zh-CN': {
                'pageTitle': 'MKNLSå¼ºæ”»å·¥å…·3.0',
                'keyHint': 'ç§˜é’¥è¯· Facebookæœç´¢GH Treeè·å–',
                'btnCheckKey': 'éªŒè¯ç§˜é’¥',
                'btnLogin': 'ç™»å½•',
                'btnKingRank': 'ä¸€é”®ä¿®æ”¹ä¸ºå›½ç‹ç­‰çº§',
                'btnChangeEmail': 'ä¿®æ”¹é‚®ç®±',
                'btnChangePassword': 'ä¿®æ”¹å¯†ç ',
                'btnToggleAdmin': 'åˆ‡æ¢ç®¡ç†å‘˜æ¨¡å¼',
                'btnHome': 'ğŸ  é¦–é¡µ',
                'btnSwitchAccount': 'ğŸ”„ åˆ‡æ¢è´¦å·',
                'btnSwitchKey': 'ğŸ”‘ åˆ‡æ¢ç§˜é’¥',
                'adminTitle': 'ğŸ”‘ ç§˜é’¥ç®¡ç†ä¸­å¿ƒ ğŸ”‘',
                'testCardLabel': 'ç”Ÿæˆæµ‹è¯•å¡',
                'testCardInfo': '1å°æ—¶æœ‰æ•ˆæœŸï¼Œä»…é™1ä¸ªè´¦å·ï¼Œä»…æ”¯æŒè§£é”æˆå°±åŠŸèƒ½',
                'btnAddKey': 'â• ç”Ÿæˆæ–°ç§˜é’¥',
                'btnRefresh': 'ğŸ”„ åˆ·æ–°åˆ—è¡¨',
                'btnCleanup': 'ğŸ—‘ï¸ æ¸…ç†è¿‡æœŸ',
                'thKey': 'ç§˜é’¥',
                'thRemark': 'å¤‡æ³¨',
                'thExpiry': 'åˆ°æœŸæ—¶é—´',
                'thAction': 'æ“ä½œ',
                'logTitle': 'æ“ä½œæ—¥å¿—',
                'systemLoaded': 'ç³»ç»Ÿï¼šé¡µé¢åŠ è½½å®Œæ¯•ã€‚',
                'modalAccountTitle': 'è´¦å·è¯¦æƒ…',
                'btnCloseModal': 'å…³é—­',
                'testCardBadge': 'æµ‹è¯•å¡',
                'testCardStatus': 'æµ‹è¯•å¡ç”¨æˆ·',
                'testCardEmailWarning': 'æµ‹è¯•å¡ä¸æ”¯æŒä¿®æ”¹é‚®ç®±åŠŸèƒ½ï¼Œè¯·è”ç³»ç®¡ç†å‘˜ä»˜è´¹ä½¿ç”¨å®Œæ•´åŠŸèƒ½ï¼',
                'testCardPasswordWarning': 'æµ‹è¯•å¡ä¸æ”¯æŒä¿®æ”¹å¯†ç åŠŸèƒ½ï¼Œè¯·è”ç³»ç®¡ç†å‘˜ä»˜è´¹ä½¿ç”¨å®Œæ•´åŠŸèƒ½ï¼',
                'superAdmin': 'è¶…çº§ç®¡ç†å‘˜',
                'normalAdmin': 'æ™®é€šç®¡ç†å‘˜',
                'adminChoiceHint': 'è¯·é€‰æ‹©æ‚¨è¦è¿›å…¥çš„æ¨¡å¼',
                'btnEnterAdmin': 'è¿›å…¥ç®¡ç†å‘˜é¢æ¿',
                'btnEnterUser': 'è¿›å…¥ç”¨æˆ·åŠŸèƒ½'
            },
            'zh-TW': {
                'pageTitle': 'MKNLSå¼·æ”»å·¥å…·3.0',
                'keyHint': 'ç§˜é‘°è«‹Facebookæœç´¢GH Treeç²å–',
                'btnCheckKey': 'é©—è­‰ç§˜é‘°',
                'btnLogin': 'ç™»éŒ„',
                'btnKingRank': 'ä¸€éµä¿®æ”¹ç‚ºåœ‹ç‹ç­‰ç´š',
                'btnChangeEmail': 'ä¿®æ”¹éƒµç®±',
                'btnChangePassword': 'ä¿®æ”¹å¯†ç¢¼',
                'btnToggleAdmin': 'åˆ‡æ›ç®¡ç†å“¡æ¨¡å¼',
                'btnHome': 'ğŸ  é¦–é ',
                'btnSwitchAccount': 'ğŸ”„ åˆ‡æ›è³¬è™Ÿ',
                'btnSwitchKey': 'ğŸ”‘ åˆ‡æ›ç§˜é‘°',
                'adminTitle': 'ğŸ”‘ ç§˜é‘°ç®¡ç†ä¸­å¿ƒ ğŸ”‘',
                'testCardLabel': 'ç”Ÿæˆæ¸¬è©¦å¡',
                'testCardInfo': '1å°æ™‚æœ‰æ•ˆæœŸï¼Œåƒ…é™1å€‹è³¬è™Ÿï¼Œåƒ…æ”¯æŒè§£é–æˆå°±åŠŸèƒ½',
                'btnAddKey': 'â• ç”Ÿæˆæ–°ç§˜é‘°',
                'btnRefresh': 'ğŸ”„ åˆ·æ–°åˆ—è¡¨',
                'btnCleanup': 'ğŸ—‘ï¸ æ¸…ç†éæœŸ',
                'thKey': 'ç§˜é‘°',
                'thRemark': 'å‚™è¨»',
                'thExpiry': 'åˆ°æœŸæ™‚é–“',
                'thAction': 'æ“ä½œ',
                'logTitle': 'æ“ä½œæ—¥èªŒ',
                'systemLoaded': 'ç³»çµ±ï¼šé é¢åŠ è¼‰å®Œç•¢ã€‚',
                'modalAccountTitle': 'è³¬è™Ÿè©³æƒ…',
                'btnCloseModal': 'é—œé–‰',
                'testCardBadge': 'æ¸¬è©¦å¡',
                'testCardStatus': 'æ¸¬è©¦å¡ç”¨æˆ¶',
                'testCardEmailWarning': 'æ¸¬è©¦å¡ä¸æ”¯æŒä¿®æ”¹éƒµç®±åŠŸèƒ½ï¼Œè«‹è¯ç¹«ç®¡ç†å“¡ä»˜è²»ä½¿ç”¨å®Œæ•´åŠŸèƒ½ï¼',
                'testCardPasswordWarning': 'æ¸¬è©¦å¡ä¸æ”¯æŒä¿®æ”¹å¯†ç¢¼åŠŸèƒ½ï¼Œè«‹è¯ç¹«ç®¡ç†å“¡ä»˜è²»ä½¿ç”¨å®Œæ•´åŠŸèƒ½ï¼',
                'superAdmin': 'è¶…ç´šç®¡ç†å“¡',
                'normalAdmin': 'æ™®é€šç®¡ç†å“¡',
                'adminChoiceHint': 'è«‹é¸æ“‡æ‚¨è¦é€²å…¥çš„æ¨¡å¼',
                'btnEnterAdmin': 'é€²å…¥ç®¡ç†å“¡é¢æ¿',
                'btnEnterUser': 'é€²å…¥ç”¨æˆ¶åŠŸèƒ½'
            },
            'en': {
                'pageTitle': 'MKNLS Boost Tool 4.0',
                'keyHint': 'Get key by searching cpm MKNLS on Kwai',
                'btnCheckKey': 'Verify Key',
                'btnLogin': 'Login',
                'btnKingRank': 'Set King Rank',
                'btnChangeEmail': 'Change Email',
                'btnChangePassword': 'Change Password',
                'btnToggleAdmin': 'Toggle Admin Mode',
                'btnHome': 'ğŸ  Home',
                'btnSwitchAccount': 'ğŸ”„ Switch Account',
                'btnSwitchKey': 'ğŸ”‘ Switch Key',
                'adminTitle': 'ğŸ”‘ Key Management Center ğŸ”‘',
                'testCardLabel': 'Generate Test Card',
                'testCardInfo': '1 hour validity, 1 account only, unlock achievement only',
                'btnAddKey': 'â• Generate New Key',
                'btnRefresh': 'ğŸ”„ Refresh List',
                'btnCleanup': 'ğŸ—‘ï¸ Clean Expired',
                'thKey': 'Key',
                'thRemark': 'Remark',
                'thExpiry': 'Expiry Time',
                'thAction': 'Action',
                'logTitle': 'Operation Log',
                'systemLoaded': 'System: Page loaded successfully.',
                'modalAccountTitle': 'Account Details',
                'btnCloseModal': 'Close',
                'testCardBadge': 'Test Card',
                'testCardStatus': 'Test Card User',
                'testCardEmailWarning': 'Test card does not support email change. Please contact admin for paid full features!',
                'testCardPasswordWarning': 'Test card does not support password change. Please contact admin for paid full features!',
                'superAdmin': 'Super Admin',
                'normalAdmin': 'Normal Admin',
                'adminChoiceHint': 'Please select the mode you want to enter',
                'btnEnterAdmin': 'Enter Admin Panel',
                'btnEnterUser': 'Enter User Functions'
            }
        };

        let currentLanguage = 'zh-CN';
        let currentKey = null;
        let currentToken = null;
        let currentExpiryTime = null;
        let currentUser = null;
        let isAdminMode = false;
        let isSuperAdmin = false;
        let currentBindInfo = null;
        let isTestCard = false;

        function changeLanguage(lang) {
            currentLanguage = lang;
            applyTranslations();
            logAction("è¯­è¨€åˆ‡æ¢", `åˆ‡æ¢åˆ° ${getLanguageName(lang)}`, 'info');
        }

        function getLanguageName(code) {
            const names = {
                'zh-CN': 'ä¸­æ–‡ç®€ä½“',
                'zh-TW': 'ä¸­æ–‡ç¹é«”',
                'en': 'English'
            };
            return names[code] || code;
        }

        function applyTranslations() {
            const langData = translations[currentLanguage];
            
            Object.keys(langData).forEach(key => {
                const element = document.getElementById(key);
                if (element && !(key === 'systemLoaded' && element.parentElement.id === 'logHistory')) {
                    element.textContent = langData[key];
                }
            });

            document.getElementById('accessKey').placeholder = currentLanguage === 'zh-CN' ? 'è¾“å…¥è®¿é—®ç§˜é’¥' : 
                                                             currentLanguage === 'zh-TW' ? 'è¼¸å…¥è¨ªå•ç§˜é‘°' : 'Enter access key';
            
            document.getElementById('email').placeholder = currentLanguage === 'zh-CN' ? 'è¾“å…¥æ‚¨çš„é‚®ç®±' : 
                                                         currentLanguage === 'zh-TW' ? 'è¼¸å…¥æ‚¨çš„éƒµç®±' : 'Enter your email';
            
            document.getElementById('password').placeholder = currentLanguage === 'zh-CN' ? 'è¾“å…¥æ‚¨çš„å¯†ç ' : 
                                                            currentLanguage === 'zh-TW' ? 'è¼¸å…¥æ‚¨çš„å¯†ç¢¼' : 'Enter your password';
            
            document.getElementById('newKeyDuration').placeholder = currentLanguage === 'zh-CN' ? 'ç§˜é’¥æ—¶é•¿ (å°æ—¶)' : 
                                                                  currentLanguage === 'zh-TW' ? 'ç§˜é‘°æ™‚é•· (å°æ™‚)' : 'Key duration (hours)';
            
            document.getElementById('newKeyMaxBind').placeholder = currentLanguage === 'zh-CN' ? 'æœ€å¤§ç»‘å®šæ•°é‡' : 
                                                                 currentLanguage === 'zh-TW' ? 'æœ€å¤§ç¶å®šæ•¸é‡' : 'Max bind count';
            
            document.getElementById('newKeyRemark').placeholder = currentLanguage === 'zh-CN' ? 'å¤‡æ³¨ (å¦‚: æœˆå¡/æµ‹è¯•å¡)' : 
                                                                currentLanguage === 'zh-TW' ? 'å‚™è¨» (å¦‚: æœˆå¡/æ¸¬è©¦å¡)' : 'Remark (e.g.: Monthly/Test)';
        }

        async function handleCheckKey(key = null) {
            key = key || document.getElementById('accessKey').value.trim();
            if (!key) {
                return updateStatus(currentLanguage === 'zh-CN' ? "è¯·è¾“å…¥ç§˜é’¥ï¼" : 
                                  currentLanguage === 'zh-TW' ? "è«‹è¼¸å…¥ç§˜é‘°ï¼" : "Please enter key!", true);
            }
            
            setButtonLoading('btnCheckKey', true);
            updateStatus(currentLanguage === 'zh-CN' ? "æ­£åœ¨éªŒè¯ç§˜é’¥ï¼Œè¯·ç¨å€™..." : 
                       currentLanguage === 'zh-TW' ? "æ­£åœ¨é©—è­‰ç§˜é‘°ï¼Œè«‹ç¨å€™..." : "Verifying key, please wait...");
            
            try {
                const email = document.getElementById('email') ? document.getElementById('email').value.trim() : null;
                
                const data = await apiRequest('/check-key', {
                    method: "POST",
                    body: JSON.stringify({ key, email })
                });

                currentKey = key;
                currentExpiryTime = data.expiryTime;
                isAdminMode = data.isAdmin;
                isSuperAdmin = data.isSuperAdmin || false;
                isTestCard = data.isTestCard || false;
                
                if (data.isAdmin && data.needsChoice) {
                    updateTestCardStatus(isTestCard);
                    updateBindInfo(data.bindCount, data.maxBind, data.remainingBinds);
                    updateStatus(data.message, false);
                    document.getElementById('adminChoice').style.display = 'block';
                    document.getElementById('keyForm').style.display = 'none';
                    logAction("ç®¡ç†å‘˜éªŒè¯", "ç®¡ç†å‘˜æ¨¡å¼é€‰æ‹©ç•Œé¢", 'info');
                    return;
                }
                
                updateTestCardStatus(isTestCard);
                updateBindInfo(data.bindCount, data.maxBind, data.remainingBinds);
                currentBindInfo = { 
                    bindCount: data.bindCount, 
                    maxBind: data.maxBind, 
                    remainingBinds: data.remainingBinds,
                    isEmailBound: data.isEmailBound
                };
                
                if (isAdminMode) {
                    document.getElementById('toggleAdminModeBtn').style.display = 'block';
                    updateStatus(data.message, false);
                    switchSection('menuButtons', ['keyForm', 'loginForm']);
                    logAction("ç®¡ç†å‘˜ç§˜é’¥", `${isSuperAdmin ? 'è¶…çº§ç®¡ç†å‘˜' : 'ç®¡ç†å‘˜'}æ¨¡å¼å¯ç”¨`, 'info');
                } else {
                    updateExpiryDisplay(
                        currentExpiryTime, 
                        data.durationHours || null, 
                        data.cardType || null
                    );
                    
                    if (data.isEmailBound && email) {
                        updateStatus(currentLanguage === 'zh-CN' ? `é‚®ç®± ${email} å·²ç»‘å®šæ­¤ç§˜é’¥ï¼Œå¯ä»¥ç›´æ¥ç™»å½•ï¼` : 
                                   currentLanguage === 'zh-TW' ? `éƒµç®± ${email} å·²ç¶å®šæ­¤ç§˜é‘°ï¼Œå¯ä»¥ç›´æ¥ç™»éŒ„ï¼` : 
                                   `Email ${email} is bound to this key, you can login directly!`, false);
                    } else if (data.remainingBinds <= 0) {
                        updateStatus(currentLanguage === 'zh-CN' ? `ç§˜é’¥ç»‘å®šå·²æ»¡ï¼ä½†å·²ç»‘å®šçš„è´¦å·ä»å¯ç™»å½•ã€‚` : 
                                   currentLanguage === 'zh-TW' ? `ç§˜é‘°ç¶å®šå·²æ»¿ï¼ä½†å·²ç¶å®šçš„è³¬è™Ÿä»å¯ç™»éŒ„ã€‚` : 
                                   `Key binding is full! But bound accounts can still login.`, true);
                    } else {
                        updateStatus(data.message, false);
                    }
                    
                    switchSection('loginForm', ['keyForm', 'menuButtons']);
                    logAction("ç§˜é’¥éªŒè¯", data.message, 'success');
                }

            } catch (error) {
                updateStatus(`${currentLanguage === 'zh-CN' ? 'éªŒè¯å¤±è´¥ï¼š' : 
                            currentLanguage === 'zh-TW' ? 'é©—è­‰å¤±æ•—ï¼š' : 'Verification failed: '}${error.message}`, true);
                updateBindInfo();
                updateTestCardStatus(false);
            } finally {
                setButtonLoading('btnCheckKey', false);
            }
        }

        async function handleLogin() {
            const email = document.getElementById('email').value.trim();
            const password = document.getElementById('password').value;

            if (!email || !password) {
                return updateStatus(currentLanguage === 'zh-CN' ? "è¯·è¾“å…¥é‚®ç®±å’Œå¯†ç ï¼" : 
                                  currentLanguage === 'zh-TW' ? "è«‹è¼¸å…¥éƒµç®±å’Œå¯†ç¢¼ï¼" : "Please enter email and password!", true);
            }
            
            setButtonLoading('btnLogin', true);
            updateStatus(currentLanguage === 'zh-CN' ? "æ­£åœ¨ç™»å½•..." : 
                       currentLanguage === 'zh-TW' ? "æ­£åœ¨ç™»éŒ„..." : "Logging in...", false);

            try {
                const data = await apiRequest('/login', {
                    method: "POST",
                    body: JSON.stringify({ email, password, key: currentKey })
                });

                currentToken = data.data.idToken;
                currentUser = data.data.email;
                saveAuthToStorage(currentKey, currentToken, currentExpiryTime, currentUser);

                updateStatus(currentLanguage === 'zh-CN' ? "ç™»å½•æˆåŠŸï¼è¿›å…¥åŠŸèƒ½èœå•ã€‚" : 
                           currentLanguage === 'zh-TW' ? "ç™»éŒ„æˆåŠŸï¼é€²å…¥åŠŸèƒ½èœå–®ã€‚" : "Login successful! Entering function menu.", false);
                switchSection('menuButtons', ['keyForm', 'loginForm']);

                logAction("ç™»å½•", `ç”¨æˆ· ${currentUser} ç™»å½•æˆåŠŸ`, 'success');

            } catch (error) {
                updateStatus(`${currentLanguage === 'zh-CN' ? 'ç™»å½•å¤±è´¥ï¼š' : 
                            currentLanguage === 'zh-TW' ? 'ç™»éŒ„å¤±æ•—ï¼š' : 'Login failed: '}${error.message}`, true);
            } finally {
                setButtonLoading('btnLogin', false);
            }
        }

        async function handleKingRank() {
            if (!checkLogin()) return;

            logAction("ç­‰çº§è®¾ç½®", "å¼€å§‹å°è¯•è®¾ç½®å›½ç‹ç­‰çº§...", 'info');
            updateStatus(currentLanguage === 'zh-CN' ? "æ­£åœ¨å°è¯•è®¾ç½®å›½ç‹ç­‰çº§..." : 
                       currentLanguage === 'zh-TW' ? "æ­£åœ¨å˜—è©¦è¨­ç½®åœ‹ç‹ç­‰ç´š..." : "Setting king rank...", false);

            try {
                const data = await apiRequest('/king-rank', {
                    method: "POST",
                    headers: { 
                        "Authorization": `Bearer ${currentToken}`
                    }
                });

                logAction("ç­‰çº§è®¾ç½®", data.message, 'success');
                updateStatus(data.message, false);

            } catch (error) {
                updateStatus(`${currentLanguage === 'zh-CN' ? 'ç­‰çº§è®¾ç½®å¤±è´¥ï¼š' : 
                            currentLanguage === 'zh-TW' ? 'ç­‰ç´šè¨­ç½®å¤±æ•—ï¼š' : 'Failed to set rank: '}${error.message}`, true);
                logAction("ç­‰çº§è®¾ç½®", `è®¾ç½®å¤±è´¥: ${error.message}`, 'error');
            }
        }

        async function handleChangeEmail() {
            if (!checkLogin()) return;

            if (isTestCard) {
                alert(translations[currentLanguage].testCardEmailWarning);
                return;
            }

            const newEmail = prompt(`${currentLanguage === 'zh-CN' ? `è¯·è¾“å…¥æ–°çš„é‚®ç®±åœ°å€ï¼ˆå½“å‰: ${currentUser}ï¼‰ï¼š` : 
                                   currentLanguage === 'zh-TW' ? `è«‹è¼¸å…¥æ–°çš„éƒµç®±åœ°å€ï¼ˆç•¶å‰: ${currentUser}ï¼‰ï¼š` : 
                                   `Enter new email address (current: ${currentUser}):`}`);
            if (!newEmail) return;

            logAction("ä¿®æ”¹é‚®ç®±", `æ­£åœ¨å°è¯•ä¿®æ”¹é‚®ç®±è‡³ ${newEmail}...`, 'info');
            updateStatus(currentLanguage === 'zh-CN' ? "æ­£åœ¨ä¿®æ”¹é‚®ç®±..." : 
                       currentLanguage === 'zh-TW' ? "æ­£åœ¨ä¿®æ”¹éƒµç®±..." : "Changing email...", false);

            try {
                const data = await apiRequest('/change-email', {
                    method: "POST",
                    body: JSON.stringify({
                        idToken: currentToken,
                        newEmail,
                        oldEmail: currentUser,
                        key: currentKey
                    }) 
                });

                currentToken = data.data.idToken;
                const oldUser = currentUser;
                currentUser = data.data.email;
                saveAuthToStorage(currentKey, currentToken, currentExpiryTime, currentUser);

                logAction("ä¿®æ”¹é‚®ç®±", `æˆåŠŸä» ${oldUser} ä¿®æ”¹ä¸º ${currentUser}`, 'success');
                updateStatus(currentLanguage === 'zh-CN' ? `é‚®ç®±ä¿®æ”¹æˆåŠŸï¼æ–°é‚®ç®±: ${currentUser}` : 
                           currentLanguage === 'zh-TW' ? `éƒµç®±ä¿®æ”¹æˆåŠŸï¼æ–°éƒµç®±: ${currentUser}` : 
                           `Email changed successfully! New email: ${currentUser}`, false);

            } catch (error) {
                updateStatus(`${currentLanguage === 'zh-CN' ? 'ä¿®æ”¹å¤±è´¥ï¼š' : 
                            currentLanguage === 'zh-TW' ? 'ä¿®æ”¹å¤±æ•—ï¼š' : 'Change failed: '}${error.message}`, true);
                logAction("ä¿®æ”¹é‚®ç®±", `ä¿®æ”¹å¤±è´¥: ${error.message}`, 'error');
            }
        }

        async function handleChangePassword() {
            if (!checkLogin()) return;

            if (isTestCard) {
                alert(translations[currentLanguage].testCardPasswordWarning);
                return;
            }

            const newPassword = prompt(currentLanguage === 'zh-CN' ? "è¯·è¾“å…¥æ–°å¯†ç ï¼ˆè‡³å°‘6ä½ï¼‰ï¼š" : 
                                     currentLanguage === 'zh-TW' ? "è«‹è¼¸å…¥æ–°å¯†ç¢¼ï¼ˆè‡³å°‘6ä½ï¼‰ï¼š" : 
                                     "Enter new password (at least 6 characters):");
            if (!newPassword) return;
            if (newPassword.length < 6) {
                return updateStatus(currentLanguage === 'zh-CN' ? "æ–°å¯†ç é•¿åº¦ä¸èƒ½å°‘äº6ä½ï¼" : 
                                  currentLanguage === 'zh-TW' ? "æ–°å¯†ç¢¼é•·åº¦ä¸èƒ½å°‘æ–¼6ä½ï¼" : 
                                  "New password must be at least 6 characters!", true);
            }

            logAction("ä¿®æ”¹å¯†ç ", "æ­£åœ¨å°è¯•ä¿®æ”¹å¯†ç ...", 'info');
            updateStatus(currentLanguage === 'zh-CN' ? "æ­£åœ¨ä¿®æ”¹å¯†ç ..." : 
                       currentLanguage === 'zh-TW' ? "æ­£åœ¨ä¿®æ”¹å¯†ç¢¼..." : "Changing password...", false);

            try {
                const data = await apiRequest('/change-password', {
                    method: "POST",
                    body: JSON.stringify({
                        idToken: currentToken,
                        newPassword,
                        email: currentUser,
                        key: currentKey
                    }) 
                });

                currentToken = data.data.idToken;
                saveAuthToStorage(currentKey, currentToken, currentExpiryTime, currentUser);

                logAction("ä¿®æ”¹å¯†ç ", "å¯†ç ä¿®æ”¹æˆåŠŸ", 'success');
                updateStatus(currentLanguage === 'zh-CN' ? "å¯†ç ä¿®æ”¹æˆåŠŸï¼" : 
                           currentLanguage === 'zh-TW' ? "å¯†ç¢¼ä¿®æ”¹æˆåŠŸï¼" : "Password changed successfully!", false);

            } catch (error) {
                updateStatus(`${currentLanguage === 'zh-CN' ? 'ä¿®æ”¹å¤±è´¥ï¼š' : 
                            currentLanguage === 'zh-TW' ? 'ä¿®æ”¹å¤±æ•—ï¼š' : 'Change failed: '}${error.message}`, true);
                logAction("ä¿®æ”¹å¯†ç ", `ä¿®æ”¹å¤±è´¥: ${error.message}`, 'error');
            }
        }

        function setButtonLoading(buttonId, loading) {
            const button = document.getElementById(buttonId);
            const textElement = button.querySelector('span') || button;
            
            if (loading) {
                button.disabled = true;
                const originalText = textElement.textContent;
                textElement.innerHTML = `<span class="cyber-spinner"></span>åŠ è½½ä¸­...`;
                button.setAttribute('data-original-text', originalText);
            } else {
                button.disabled = false;
                const originalText = button.getAttribute('data-original-text');
                if (originalText) {
                    textElement.textContent = originalText;
                }
            }
        }

        function logAction(action, message, type) {
            const logHistory = document.getElementById('logHistory');
            const now = new Date().toLocaleTimeString('zh-CN', { hour12: false });
            
            const typeClass = `log-${type}`;
            const logItem = document.createElement('div');
            logItem.className = `ios-log-item ${typeClass}`;
            
            let logContent = `${now} [${action}] `;
            if (isAdminMode) {
                 logContent += `(${isSuperAdmin ? 'è¶…çº§ç®¡ç†å‘˜' : 'ç®¡ç†å‘˜'}): `;
            } else if (currentUser) {
                logContent += `(${currentUser}): `;
            } else {
                logContent += `(æ¸¸å®¢): `;
            }
            logContent += message;

            logItem.textContent = logContent;
            
            logHistory.prepend(logItem);

            while (logHistory.children.length > 15) {
                logHistory.removeChild(logHistory.lastChild);
            }
        }

        function updateStatus(message, isError = false) {
            const statusEl = document.getElementById('statusMessage');
            statusEl.textContent = message;
            
            if (isTestCard) {
                statusEl.className = 'cyber-status error';
            } else if (isAdminMode) {
                statusEl.className = 'cyber-status';
            } else {
                statusEl.className = 'cyber-status ' + (isError ? 'error' : 'success');
            }
        }

        function updateBindInfo(bindCount, maxBind, remainingBinds) {
            const bindInfoEl = document.getElementById('bindInfo');
            if (bindCount !== undefined && maxBind !== undefined && remainingBinds !== undefined) {
                const bindText = currentLanguage === 'zh-CN' ? `å½“å‰ç»‘å®š: ${bindCount}/${maxBind} | å‰©ä½™: ${remainingBinds}` :
                               currentLanguage === 'zh-TW' ? `ç•¶å‰ç¶å®š: ${bindCount}/${maxBind} | å‰©é¤˜: ${remainingBinds}` :
                               `Current: ${bindCount}/${maxBind} | Remaining: ${remainingBinds}`;
                bindInfoEl.textContent = bindText;
                bindInfoEl.style.display = 'block';
                
                if (remainingBinds <= 2) {
                    bindInfoEl.style.backgroundColor = 'rgba(255, 0, 85, 0.3)';
                    bindInfoEl.style.borderColor = 'rgba(255, 0, 85, 0.5)';
                    bindInfoEl.style.color = '#ff6680';
                } else {
                    bindInfoEl.style.backgroundColor = 'rgba(255, 149, 0, 0.3)';
                    bindInfoEl.style.borderColor = 'rgba(255, 149, 0, 0.5)';
                    bindInfoEl.style.color = 'white';
                }
            } else {
                bindInfoEl.style.display = 'none';
            }
        }

        function showNavButtons() {
            document.getElementById('navButtons').style.display = 'block';
        }

        function hideNavButtons() {
            document.getElementById('navButtons').style.display = 'none';
        }

        function switchSection(showId, hideIds) {
            document.getElementById(showId).style.display = 'block';
            hideIds.forEach(id => {
                document.getElementById(id).style.display = 'none';
            });
            
            if (showId !== 'keyForm') {
                showNavButtons();
            } else {
                hideNavButtons();
            }
        }

        function checkLogin() {
            if (!currentToken || !currentKey) {
                updateStatus(currentLanguage === 'zh-CN' ? "è¯·å…ˆç™»å½•ï¼" : 
                            currentLanguage === 'zh-TW' ? "è«‹å…ˆç™»éŒ„ï¼" : "Please login first!", true);
                handleLogout(true); 
                return false;
            }
            return true;
        }
        
        function saveAuthToStorage(key, token, expiry, user) {
            localStorage.setItem('accessKey', key);
            localStorage.setItem('idToken', token);
            localStorage.setItem('expiryTime', expiry);
            localStorage.setItem('currentUser', user);
            localStorage.setItem('currentLanguage', currentLanguage);
        }

        function loadAuthFromStorage() {
            currentKey = localStorage.getItem('accessKey');
            currentToken = localStorage.getItem('idToken');
            currentExpiryTime = localStorage.getItem('expiryTime');
            currentUser = localStorage.getItem('currentUser');
            const savedLang = localStorage.getItem('currentLanguage');
            if (savedLang) {
                currentLanguage = savedLang;
                document.getElementById('languageSelect').value = currentLanguage;
                applyTranslations();
            }
            return currentKey && currentToken;
        }

        function updateExpiryDisplay(expiryTime, durationHours, specialTag = null, clear = false) {
            const displayEl = document.getElementById('expiryDisplay');
            if (clear || !expiryTime) {
                displayEl.textContent = '';
                displayEl.className = '';
                return;
            }
            
            let vipLevel = "";
            
            if (isTestCard) {
                vipLevel = translations[currentLanguage].testCardStatus;
            } else if (specialTag === 'DIAMOND_EXCLUSIVE') {
                vipLevel = "è‡³å°ŠVIP";
            } else if (durationHours !== null) {
                const hours = durationHours;
                
                if (hours >= 365 * 24 * 5) {
                    vipLevel = "é’»çŸ³VIP";
                } else if (hours >= 30 * 24) { 
                    vipLevel = "é“‚é‡‘VIP";
                } else if (hours >= 7 * 24) { 
                    vipLevel = "é»„é‡‘VIP";
                } else if (hours >= 24) {
                    vipLevel = "ç™½é“¶VIP";
                } else {
                    vipLevel = "é’é“œVIP";
                }
            } else {
                vipLevel = currentLanguage === 'zh-CN' ? "å°Šè´µçš„ç”¨æˆ·" : 
                          currentLanguage === 'zh-TW' ? "å°Šè²´çš„ç”¨æˆ¶" : "Valued User";
            }

            const welcomeText = currentLanguage === 'zh-CN' ? `æ¬¢è¿ç™»å½•ï¼Œ<strong>${vipLevel}</strong>ç”¨æˆ·ï¼` :
                              currentLanguage === 'zh-TW' ? `æ­¡è¿ç™»éŒ„ï¼Œ<strong>${vipLevel}</strong>ç”¨æˆ¶ï¼` :
                              `Welcome, <strong>${vipLevel}</strong>!`;

            let expiryHtml = welcomeText + `<br>`;
            
            if (expiryTime) {
                expiryHtml += `<div style="color: var(--cyber-pink); font-weight: bold; text-align: center; padding: 8px; border-radius: 8px; margin: 10px 0; background: rgba(255,0,255,0.1); border: 1px solid rgba(255,0,255,0.3);">ç§˜é’¥å°†äº ${expiryTime} åˆ°æœŸ</div>`;
            }

            displayEl.innerHTML = expiryHtml;
        }

        function updateTestCardStatus(isTest) {
            isTestCard = isTest;
            const statusEl = document.getElementById('statusMessage');
            
            if (isTest) {
                statusEl.className = 'cyber-status error';
                document.getElementById('btnChangeEmail').disabled = true;
                document.getElementById('btnChangePassword').disabled = true;
                document.getElementById('btnChangeEmail').title = translations[currentLanguage].testCardEmailWarning;
                document.getElementById('btnChangePassword').title = translations[currentLanguage].testCardPasswordWarning;
            } else {
                document.getElementById('btnChangeEmail').disabled = false;
                document.getElementById('btnChangePassword').disabled = false;
                document.getElementById('btnChangeEmail').title = '';
                document.getElementById('btnChangePassword').title = '';
            }
        }

        function enterAdminPanel() {
            document.getElementById('adminChoice').style.display = 'none';
            document.getElementById('menuButtons').style.display = 'block';
            document.getElementById('toggleAdminModeBtn').style.display = 'block';
            updateStatus(currentLanguage === 'zh-CN' ? "å·²è¿›å…¥ç®¡ç†å‘˜æ¨¡å¼ï¼Œç‚¹å‡»ä¸Šæ–¹æŒ‰é’®åˆ‡æ¢ç®¡ç†é¢æ¿" : 
                       currentLanguage === 'zh-TW' ? "å·²é€²å…¥ç®¡ç†å“¡æ¨¡å¼ï¼Œé»æ“Šä¸Šæ–¹æŒ‰éˆ•åˆ‡æ›ç®¡ç†é¢æ¿" : "Entered admin mode, click button above to toggle admin panel", false);
        }

        function enterUserPanel() {
            document.getElementById('adminChoice').style.display = 'none';
            document.getElementById('loginForm').style.display = 'block';
            updateStatus(currentLanguage === 'zh-CN' ? "è¯·ç™»å½•æ‚¨çš„æ¸¸æˆè´¦å·ä½¿ç”¨åŠŸèƒ½" : 
                       currentLanguage === 'zh-TW' ? "è«‹ç™»éŒ„æ‚¨çš„éŠæˆ²è³¬è™Ÿä½¿ç”¨åŠŸèƒ½" : "Please login with your game account to use functions", false);
        }

        function toggleAdminMode() {
            if (!isAdminMode) return;

            const isViewingAdmin = document.getElementById('adminPanel').style.display === 'block';
            
            if (isViewingAdmin) {
                document.getElementById('adminPanel').style.display = 'none';
                document.getElementById('menuButtons').style.display = 'block';
                updateStatus(currentLanguage === 'zh-CN' ? "å·²é€€å‡ºç®¡ç†å‘˜é¢æ¿" : 
                           currentLanguage === 'zh-TW' ? "å·²é€€å‡ºç®¡ç†å“¡é¢æ¿" : "Exited admin panel", false);
            } else {
                document.getElementById('menuButtons').style.display = 'none';
                document.getElementById('adminPanel').style.display = 'block';
                updateStatus(currentLanguage === 'zh-CN' ? "ç®¡ç†å‘˜é¢æ¿å·²å¼€å¯" : 
                           currentLanguage === 'zh-TW' ? "ç®¡ç†å“¡é¢æ¿å·²é–‹å•Ÿ" : "Admin panel opened", false);
                updateAdminUI();
                fetchKeys();
            }
        }

        function updateAdminUI() {
            const adminLevelBadge = document.getElementById('adminLevelBadge');
            const testCardOption = document.getElementById('testCardOption');
            const normalKeyOptions = document.getElementById('normalKeyOptions');
            
            if (isSuperAdmin) {
                adminLevelBadge.textContent = translations[currentLanguage].superAdmin;
                document.getElementById('testCardOption').style.display = 'block';
                normalKeyOptions.style.display = 'block';
            } else {
                adminLevelBadge.textContent = translations[currentLanguage].normalAdmin;
                document.getElementById('testCardOption').style.display = 'none';
                normalKeyOptions.style.display = 'none';
                document.getElementById('isTestCard').checked = true;
                toggleTestCardOptions();
            }
        }

        function toggleTestCardOptions() {
            const isTestCard = document.getElementById('isTestCard').checked;
            const normalOptions = document.getElementById('normalKeyOptions');
            
            if (isTestCard) {
                normalOptions.style.display = 'none';
                document.getElementById('newKeyDuration').value = 1;
                document.getElementById('newKeyMaxBind').value = 1;
            } else {
                normalOptions.style.display = 'block';
                document.getElementById('newKeyDuration').value = 24;
                document.getElementById('newKeyMaxBind').value = 3;
            }
        }

        async function fetchKeys() {
            if (!isAdminMode) return;
            logAction("ç§˜é’¥ç®¡ç†", "æ­£åœ¨è·å–åˆ†ç±»ç§˜é’¥åˆ—è¡¨...", 'info');
            updateStatus(currentLanguage === 'zh-CN' ? "æ­£åœ¨è·å–åˆ†ç±»ç§˜é’¥åˆ—è¡¨..." : 
                       currentLanguage === 'zh-TW' ? "æ­£åœ¨ç²å–åˆ†é¡ç§˜é‘°åˆ—è¡¨..." : "Fetching categorized key list...", false);

            try {
                const data = await apiRequest(`/admin/keys?key=${currentKey}`, {
                    method: "GET"
                });

                renderKeysTable(data.keys);
                updateStatus(currentLanguage === 'zh-CN' ? `æˆåŠŸè·å–åˆ†ç±»ç§˜é’¥ä¿¡æ¯` : 
                           currentLanguage === 'zh-TW' ? `æˆåŠŸç²å–åˆ†é¡ç§˜é‘°ä¿¡æ¯` : 
                           `Successfully got categorized key info`, false);
                logAction("ç§˜é’¥ç®¡ç†", "æˆåŠŸè·å–åˆ†ç±»ç§˜é’¥åˆ—è¡¨", 'success');

            } catch (error) {
                updateStatus(`${currentLanguage === 'zh-CN' ? 'è·å–åˆ—è¡¨å¤±è´¥ï¼š' : 
                            currentLanguage === 'zh-TW' ? 'ç²å–åˆ—è¡¨å¤±æ•—ï¼š' : 'Failed to get list: '}${error.message}`, true);
                logAction("ç§˜é’¥ç®¡ç†", `è·å–åˆ—è¡¨å¤±è´¥ï¼š${error.message}`, 'error');
            }
        }

        function renderKeysTable(categorizedKeys) {
            const tgTbody = document.getElementById('tgKeysTableBody');
            if (tgTbody) tgTbody.innerHTML = '';
            const tgKeys = categorizedKeys.telegram || [];
            
            tgKeys.forEach(keyData => {
                renderKeyRow(tgTbody, keyData, 'tg');
            });
            document.getElementById('tgKeyCount').textContent = `${tgKeys.length}`;
            
            const superAdminTbody = document.getElementById('superAdminKeysTableBody');
            if (superAdminTbody) superAdminTbody.innerHTML = '';
            const superAdminKeys = categorizedKeys.superAdmin || [];
            
            superAdminKeys.forEach(keyData => {
                renderKeyRow(superAdminTbody, keyData, 'super');
            });
            document.getElementById('superAdminKeyCount').textContent = `${superAdminKeys.length}`;
            
            const normalAdminContainer = document.getElementById('normalAdminCategories');
            if (normalAdminContainer) normalAdminContainer.innerHTML = '';
            
            Object.values(categorizedKeys.normalAdmins || {}).forEach(adminData => {
                const categoryId = `admin-${adminData.adminKey.replace(/[^a-zA-Z0-9]/g, '-')}`;
                const categoryHtml = `
                    <details style="border-bottom: 1px solid rgba(0,243,255,0.2);">
                        <summary style="padding: 15px; background: rgba(0,255,157,0.1); cursor: pointer; font-weight: 600; color: var(--cyber-green);">
                            <span>ğŸ‘¤ ${adminData.adminName}</span>
                            <span style="background: var(--cyber-green); padding: 2px 8px; border-radius: 10px; font-size: 12px; margin-left: 10px;">${adminData.keys.length}</span>
                        </summary>
                        <table style="width: 100%; border-collapse: collapse; color: white;">
                            <thead>
                                <tr>
                                    <th style="padding: 12px 8px; text-align: left; background: rgba(0,255,157,0.2);">ç§˜é’¥</th>
                                    <th style="padding: 12px 8px; text-align: left; background: rgba(0,255,157,0.2);">å¤‡æ³¨</th>
                                    <th style="padding: 12px 8px; text-align: left; background: rgba(0,255,157,0.2);">åˆ°æœŸæ—¶é—´</th>
                                    <th style="padding: 12px 8px; text-align: left; background: rgba(0,255,157,0.2);">æ“ä½œ</th>
                                </tr>
                            </thead>
                            <tbody id="${categoryId}-body"></tbody>
                        </table>
                    </details>
                `;
                normalAdminContainer.innerHTML += categoryHtml;
                
                const tbody = document.getElementById(`${categoryId}-body`);
                adminData.keys.forEach(keyData => {
                    renderKeyRow(tbody, keyData, 'normal');
                });
            });
        }

        function renderKeyRow(tbody, keyData, type) {
            if (!tbody) return;
            
            const isActivated = keyData.isActivated;
            const expiryTimeStr = isActivated 
                ? new Date(keyData.expiryTime).toLocaleTimeString('zh-CN', { hour12: false, year: 'numeric', month: '2-digit', day: '2-digit', hour: '2-digit', minute: '2-digit' }) 
                : (currentLanguage === 'zh-CN' ? 'æœªæ¿€æ´»' : 'Not activated');
                
            const expiryClass = (isActivated && (new Date(keyData.expiryTime).getTime() - Date.now() < 24 * 3600 * 1000)) ? 'style="color: var(--cyber-red); font-weight: bold;"' : '';

            const boundEmails = keyData.boundEmails || [];
            const bindCount = boundEmails.length;
            const maxBind = keyData.maxBind || 3;
            const bindInfo = ` (${bindCount}/${maxBind})`;

            const testCardBadge = keyData.isTestCard ? `<span style="background: var(--cyber-red); color: white; padding: 2px 6px; border-radius: 10px; font-size: 10px; margin-left: 5px;">${translations[currentLanguage].testCardBadge}</span>` : '';
            
            let addedByInfo = '';
            if (type === 'tg' && keyData.telegramUser) {
                const tgUser = keyData.telegramUser;
                addedByInfo = `<br><small style="color: rgba(255,255,255,0.6);">TGç”¨æˆ·: ${tgUser.username || tgUser.firstName || 'æœªçŸ¥'}</small>`;
            } else if (keyData.addedByName) {
                addedByInfo = `<br><small style="color: rgba(255,255,255,0.6);">${keyData.addedByName}</small>`;
            }

            const row = tbody.insertRow();
            
            if (type === 'tg') {
                const kuaishouCode = keyData.applicationInfo ? keyData.applicationInfo.kuaishouCode : 'æœªè®°å½•';
                row.innerHTML = `
                    <td style="padding: 12px 8px; border-bottom: 1px solid rgba(255,255,255,0.1);">${keyData.key}${testCardBadge}${addedByInfo}</td>
                    <td style="padding: 12px 8px; border-bottom: 1px solid rgba(255,255,255,0.1);">${keyData.telegramUser ? (keyData.telegramUser.username || keyData.telegramUser.firstName || 'æœªçŸ¥') : 'æœªçŸ¥'}</td>
                    <td style="padding: 12px 8px; border-bottom: 1px solid rgba(255,255,255,0.1);">${kuaishouCode}</td>
                    <td style="padding: 12px 8px; border-bottom: 1px solid rgba(255,255,255,0.1);" ${expiryClass}>${expiryTimeStr.replace(/\//g, '-')}</td>
                    <td style="padding: 12px 8px; border-bottom: 1px solid rgba(255,255,255,0.1);">
                        <div style="display: flex; gap: 5px;">
                            <button style="padding: 6px 10px; border: none; border-radius: 6px; background: var(--cyber-blue); color: white; font-size: 12px; cursor: pointer;" onclick="copyKey('${keyData.key}')">å¤åˆ¶</button>
                            <button style="padding: 6px 10px; border: none; border-radius: 6px; background: var(--cyber-green); color: white; font-size: 12px; cursor: pointer;" onclick="viewAccountDetails('${keyData.key}')">è¯¦æƒ…</button>
                            <button style="padding: 6px 10px; border: none; border-radius: 6px; background: var(--cyber-red); color: white; font-size: 12px; cursor: pointer;" onclick="handleDeleteKey('${keyData.key}')">åˆ é™¤</button>
                        </div>
                    </td>
                `;
            } else {
                row.innerHTML = `
                    <td style="padding: 12px 8px; border-bottom: 1px solid rgba(255,255,255,0.1);">${keyData.key}${testCardBadge}${addedByInfo}</td>
                    <td style="padding: 12px 8px; border-bottom: 1px solid rgba(255,255,255,0.1);">${(keyData.remark || 'æ— ') + bindInfo}</td>
                    <td style="padding: 12px 8px; border-bottom: 1px solid rgba(255,255,255,0.1);" ${expiryClass}>${expiryTimeStr.replace(/\//g, '-')}</td>
                    <td style="padding: 12px 8px; border-bottom: 1px solid rgba(255,255,255,0.1);">
                        <div style="display: flex; gap: 5px;">
                            <button style="padding: 6px 10px; border: none; border-radius: 6px; background: var(--cyber-blue); color: white; font-size: 12px; cursor: pointer;" onclick="copyKey('${keyData.key}')">å¤åˆ¶</button>
                            <button style="padding: 6px 10px; border: none; border-radius: 6px; background: var(--cyber-green); color: white; font-size: 12px; cursor: pointer;" onclick="viewAccountDetails('${keyData.key}')">è¯¦æƒ…</button>
                            <button style="padding: 6px 10px; border: none; border-radius: 6px; background: var(--cyber-red); color: white; font-size: 12px; cursor: pointer;" onclick="handleDeleteKey('${keyData.key}')">åˆ é™¤</button>
                        </div>
                    </td>
                `;
            }
        }

        async function handleAddKey() {
            if (!isAdminMode) return;

            const isTestCard = document.getElementById('isTestCard').checked;
            const duration = parseInt(document.getElementById('newKeyDuration').value);
            const maxBind = parseInt(document.getElementById('newKeyMaxBind').value) || 3;
            const remark = document.getElementById('newKeyRemark').value.trim();

            if (!isTestCard && (isNaN(duration) || duration <= 0)) {
                return alert(currentLanguage === 'zh-CN' ? "è¯·è¾“å…¥æœ‰æ•ˆçš„ç§˜é’¥æ—¶é•¿ (å°æ—¶)" : 
                            currentLanguage === 'zh-TW' ? "è«‹è¼¸å…¥æœ‰æ•ˆçš„ç§˜é‘°æ™‚é•· (å°æ™‚)" : "Please enter valid key duration (hours)");
            }

            if (!isTestCard && (isNaN(maxBind) || maxBind <= 0)) {
                return alert(currentLanguage === 'zh-CN' ? "è¯·è¾“å…¥æœ‰æ•ˆçš„æœ€å¤§ç»‘å®šæ•°é‡" : 
                            currentLanguage === 'zh-TW' ? "è«‹è¼¸å…¥æœ‰æ•ˆçš„æœ€å¤§ç¶å®šæ•¸é‡" : "Please enter valid max bind count");
            }
            
            logAction("ç§˜é’¥ç®¡ç†", `æ­£åœ¨ç”Ÿæˆ${isTestCard ? 'æµ‹è¯•å¡' : 'ç§˜é’¥'}...`, 'info');
            updateStatus(currentLanguage === 'zh-CN' ? "æ­£åœ¨ç”Ÿæˆå¹¶æ–°å¢ç§˜é’¥..." : 
                       currentLanguage === 'zh-TW' ? "æ­£åœ¨ç”Ÿæˆä¸¦æ–°å¢ç§˜é‘°..." : "Generating new key...", false);

            try {
                const data = await apiRequest(`/admin/keys?key=${currentKey}`, {
                    method: "POST",
                    body: JSON.stringify({ 
                        durationHours: duration, 
                        maxBind: maxBind, 
                        remark: remark,
                        isTestCard: isTestCard 
                    })
                });

                const successMessage = isTestCard ? 
                    (currentLanguage === 'zh-CN' ? `æµ‹è¯•å¡ç”ŸæˆæˆåŠŸï¼\nç§˜é’¥: ${data.key}\næ—¶é•¿: 1 å°æ—¶\næœ€å¤§ç»‘å®š: 1 ä¸ªè´¦å·\nå¤‡æ³¨: ${remark || 'æµ‹è¯•å¡'}` :
                     currentLanguage === 'zh-TW' ? `æ¸¬è©¦å¡ç”ŸæˆæˆåŠŸï¼\nç§˜é‘°: ${data.key}\næ™‚é•·: 1 å°æ™‚\næœ€å¤§ç¶å®š: 1 å€‹è³¬è™Ÿ\nå‚™è¨»: ${remark || 'æ¸¬è©¦å¡'}` :
                     `Test card generated successfully!\nKey: ${data.key}\nDuration: 1 hour\nMax Bind: 1 account\nRemark: ${remark || 'Test Card'}`) :
                    (currentLanguage === 'zh-CN' ? `ç§˜é’¥ç”ŸæˆæˆåŠŸï¼\nç§˜é’¥: ${data.key}\næ—¶é•¿: ${duration} å°æ—¶\næœ€å¤§ç»‘å®š: ${maxBind} ä¸ªè´¦å·\nå¤‡æ³¨: ${remark || 'æ— '}` :
                     currentLanguage === 'zh-TW' ? `ç§˜é‘°ç”ŸæˆæˆåŠŸï¼\nç§˜é‘°: ${data.key}\næ™‚é•·: ${duration} å°æ™‚\næœ€å¤§ç¶å®š: ${maxBind} å€‹è³¬è™Ÿ\nå‚™è¨»: ${remark || 'ç„¡'}` :
                     `Key generated successfully!\nKey: ${data.key}\nDuration: ${duration} hours\nMax Bind: ${maxBind} accounts\nRemark: ${remark || 'None'}`);
                
                alert(successMessage);
                
                logAction("ç§˜é’¥ç®¡ç†", `æˆåŠŸç”Ÿæˆ${isTestCard ? 'æµ‹è¯•å¡' : 'ç§˜é’¥'}: ${data.key}`, 'success');
                
                fetchKeys();

            } catch (error) {
                updateStatus(`${currentLanguage === 'zh-CN' ? 'æ–°å¢ç§˜é’¥å¤±è´¥ï¼š' : 
                            currentLanguage === 'zh-TW' ? 'æ–°å¢ç§˜é‘°å¤±æ•—ï¼š' : 'Failed to add key: '}${error.message}`, true);
                logAction("ç§˜é’¥ç®¡ç†", `æ–°å¢ç§˜é’¥å¤±è´¥ï¼š${error.message}`, 'error');
            }
        }

        async function handleCleanupExpiredKeys() {
            if (!isAdminMode) return;
            
            const confirmMessage = currentLanguage === 'zh-CN' ? 'ç¡®å®šè¦æ¸…ç†æ‰€æœ‰è¿‡æœŸç§˜é’¥å—ï¼Ÿæ­¤æ“ä½œä¸å¯é€†ï¼' :
                                 currentLanguage === 'zh-TW' ? 'ç¢ºå®šè¦æ¸…ç†æ‰€æœ‰éæœŸç§˜é‘°å—ï¼Ÿæ­¤æ“ä½œä¸å¯é€†ï¼' :
                                 'Are you sure you want to clean up all expired keys? This operation is irreversible!';
            
            if (!confirm(confirmMessage)) return;

            logAction("ç§˜é’¥ç®¡ç†", "æ­£åœ¨æ¸…ç†è¿‡æœŸç§˜é’¥...", 'info');
            updateStatus(currentLanguage === 'zh-CN' ? "æ­£åœ¨æ¸…ç†è¿‡æœŸç§˜é’¥..." : 
                       currentLanguage === 'zh-TW' ? "æ­£åœ¨æ¸…ç†éæœŸç§˜é‘°..." : "Cleaning expired keys...", false);

            try {
                const data = await apiRequest(`/admin/cleanup-expired-keys?key=${currentKey}`, {
                    method: "POST"
                });

                logAction("ç§˜é’¥ç®¡ç†", data.message, 'success');
                updateStatus(data.message, false);
                
                fetchKeys();

            } catch (error) {
                updateStatus(`${currentLanguage === 'zh-CN' ? 'æ¸…ç†å¤±è´¥ï¼š' : 
                            currentLanguage === 'zh-TW' ? 'æ¸…ç†å¤±æ•—ï¼š' : 'Cleanup failed: '}${error.message}`, true);
                logAction("ç§˜é’¥ç®¡ç†", `æ¸…ç†å¤±è´¥: ${error.message}`, 'error');
            }
        }
        
        async function handleDeleteKey(keyToDelete) {
            if (!isAdminMode) return;
            
            const confirmMessage = currentLanguage === 'zh-CN' ? `ç¡®å®šè¦æ°¸ä¹…åˆ é™¤ç§˜é’¥ï¼š${keyToDelete} å—ï¼Ÿ\næ­¤æ“ä½œä¸å¯é€†ï¼` :
                                 currentLanguage === 'zh-TW' ? `ç¢ºå®šè¦æ°¸ä¹…åˆªé™¤ç§˜é‘°ï¼š${keyToDelete} å—ï¼Ÿ\næ­¤æ“ä½œä¸å¯é€†ï¼` :
                                 `Are you sure you want to permanently delete key: ${keyToDelete}?\nThis operation is irreversible!`;
            
            if (!confirm(confirmMessage)) return;

            logAction("ç§˜é’¥ç®¡ç†", `æ­£åœ¨åˆ é™¤ç§˜é’¥: ${keyToDelete}...`, 'info');
            updateStatus(`${currentLanguage === 'zh-CN' ? 'æ­£åœ¨åˆ é™¤ç§˜é’¥: ' : 
                        currentLanguage === 'zh-TW' ? 'æ­£åœ¨åˆªé™¤ç§˜é‘°: ' : 'Deleting key: '}${keyToDelete}...`, false);

            try {
                const data = await apiRequest(`/admin/keys?key=${currentKey}&keyToDelete=${keyToDelete}`, {
                    method: "DELETE"
                });

                logAction("ç§˜é’¥ç®¡ç†", `æˆåŠŸåˆ é™¤ç§˜é’¥: ${keyToDelete}`, 'success');
                updateStatus(`${currentLanguage === 'zh-CN' ? 'æˆåŠŸåˆ é™¤ç§˜é’¥: ' : 
                            currentLanguage === 'zh-TW' ? 'æˆåŠŸåˆªé™¤ç§˜é‘°: ' : 'Successfully deleted key: '}${keyToDelete}`, false);
                
                fetchKeys();

            } catch (error) {
                updateStatus(`${currentLanguage === 'zh-CN' ? 'åˆ é™¤ç§˜é’¥å¤±è´¥ï¼š' : 
                            currentLanguage === 'zh-TW' ? 'åˆªé™¤ç§˜é‘°å¤±æ•—ï¼š' : 'Failed to delete key: '}${error.message}`, true);
                logAction("ç§˜é’¥ç®¡ç†", `åˆ é™¤ç§˜é’¥å¤±è´¥ï¼š${error.message}`, 'error');
            }
        }

        function viewAccountDetails(key) {
            fetch(`${API_BASE_URL}/admin/keys?key=${currentKey}`)
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        const keyData = data.keys.find(k => k.key === key);
                        if (keyData) {
                            showAccountDetails(keyData);
                        }
                    }
                })
                .catch(error => {
                    alert(`${currentLanguage === 'zh-CN' ? 'è·å–è´¦å·è¯¦æƒ…å¤±è´¥: ' : 
                          currentLanguage === 'zh-TW' ? 'ç²å–è³¬è™Ÿè©³æƒ…å¤±æ•—: ' : 'Failed to get account details: '}${error.message}`);
                });
        }

        function showAccountDetails(keyData) {
            const modal = document.getElementById('accountModal');
            const detailsEl = document.getElementById('accountDetails');
            
            const activationTime = keyData.activationTime ? 
                new Date(keyData.activationTime).toLocaleString('zh-CN', { hour12: false }) : 
                (currentLanguage === 'zh-CN' ? 'æœªæ¿€æ´»' : 
                 currentLanguage === 'zh-TW' ? 'æœªæ¿€æ´»' : 'Not activated');
            const expiryTime = keyData.expiryTime ? 
                new Date(keyData.expiryTime).toLocaleString('zh-CN', { hour12: false }) : 
                (currentLanguage === 'zh-CN' ? 'æœªæ¿€æ´»' : 
                 currentLanguage === 'zh-TW' ? 'æœªæ¿€æ´»' : 'Not activated');
            
            const keyLabel = currentLanguage === 'zh-CN' ? 'ç§˜é’¥:' : 
                            currentLanguage === 'zh-TW' ? 'ç§˜é‘°:' : 'Key:';
            const remarkLabel = currentLanguage === 'zh-CN' ? 'å¤‡æ³¨:' : 
                               currentLanguage === 'zh-TW' ? 'å‚™è¨»:' : 'Remark:';
            const statusLabel = currentLanguage === 'zh-CN' ? 'çŠ¶æ€:' : 
                               currentLanguage === 'zh-TW' ? 'ç‹€æ…‹:' : 'Status:';
            const activateTimeLabel = currentLanguage === 'zh-CN' ? 'å¯ç”¨æ—¶é—´:' : 
                                    currentLanguage === 'zh-TW' ? 'å•Ÿç”¨æ™‚é–“:' : 'Activation Time:';
            const expiryTimeLabel = currentLanguage === 'zh-CN' ? 'åˆ°æœŸæ—¶é—´:' : 
                                   currentLanguage === 'zh-TW' ? 'åˆ°æœŸæ™‚é–“:' : 'Expiry Time:';
            const bindCountLabel = currentLanguage === 'zh-CN' ? 'ç»‘å®šæ•°é‡:' : 
                                  currentLanguage === 'zh-TW' ? 'ç¶å®šæ•¸é‡:' : 'Bind Count:';
            const addedByLabel = currentLanguage === 'zh-CN' ? 'æ·»åŠ è€…:' : 
                               currentLanguage === 'zh-TW' ? 'æ·»åŠ è€…:' : 'Added By:';
            const activatedStatus = currentLanguage === 'zh-CN' ? 'å·²æ¿€æ´»' : 
                                  currentLanguage === 'zh-TW' ? 'å·²æ¿€æ´»' : 'Activated';
            const notActivatedStatus = currentLanguage === 'zh-CN' ? 'æœªæ¿€æ´»' : 
                                     currentLanguage === 'zh-TW' ? 'æœªæ¿€æ´»' : 'Not activated';
            const boundAccountsLabel = currentLanguage === 'zh-CN' ? 'ç»‘å®šçš„è´¦å·:' : 
                                      currentLanguage === 'zh-TW' ? 'ç¶å®šçš„è³¬è™Ÿ:' : 'Bound Accounts:';
            const noAccountsLabel = currentLanguage === 'zh-CN' ? 'æš‚æ— ç»‘å®šçš„è´¦å·' : 
                                   currentLanguage === 'zh-TW' ? 'æš«ç„¡ç¶å®šçš„è³¬è™Ÿ' : 'No bound accounts';
            
            let html = `<div style="margin-bottom: 16px;">
                <strong>${keyLabel}</strong> ${keyData.key}<br>
                <strong>${remarkLabel}</strong> ${keyData.remark || (currentLanguage === 'zh-CN' ? 'æ— ' : 
                                                                   currentLanguage === 'zh-TW' ? 'ç„¡' : 'None')}<br>
                <strong>${statusLabel}</strong> ${keyData.isActivated ? activatedStatus : notActivatedStatus}<br>
                <strong>${activateTimeLabel}</strong> ${activationTime}<br>
                <strong>${expiryTimeLabel}</strong> ${expiryTime}<br>
                <strong>${bindCountLabel}</strong> ${(keyData.boundEmails || []).length}/${keyData.maxBind || 3}<br>
                <strong>${addedByLabel}</strong> ${keyData.addedByName || (currentLanguage === 'zh-CN' ? 'æœªçŸ¥' : 
                                                                         currentLanguage === 'zh-TW' ? 'æœªçŸ¥' : 'Unknown')}
            </div>`;

            if (keyData.telegramUser) {
                const tgUser = keyData.telegramUser;
                const tgLabel = currentLanguage === 'zh-CN' ? 'Telegramç”¨æˆ·ä¿¡æ¯:' : 
                               currentLanguage === 'zh-TW' ? 'Telegramç”¨æˆ¶ä¿¡æ¯:' : 'Telegram User:';
                const idLabel = currentLanguage === 'zh-CN' ? 'ç”¨æˆ·ID:' : 
                               currentLanguage === 'zh-TW' ? 'ç”¨æˆ¶ID:' : 'User ID:';
                const nameLabel = currentLanguage === 'zh-CN' ? 'ç”¨æˆ·å:' : 
                                 currentLanguage === 'zh-TW' ? 'ç”¨æˆ¶å:' : 'Username:';
                const firstNameLabel = currentLanguage === 'zh-CN' ? 'åå­—:' : 
                                     currentLanguage === 'zh-TW' ? 'åå­—:' : 'First Name:';
                
                html += `<div style="margin: 16px 0; padding: 12px; background: rgba(0, 122, 255, 0.1); border-radius: 8px;">
                    <strong>${tgLabel}</strong><br>
                    <strong>${idLabel}</strong> ${tgUser.id}<br>
                    <strong>${nameLabel}</strong> ${tgUser.username || 'æ— '}<br>
                    <strong>${firstNameLabel}</strong> ${tgUser.firstName || 'æ— '}
                </div>`;
            }

            if (keyData.applicationInfo) {
                const appInfo = keyData.applicationInfo;
                const applyLabel = currentLanguage === 'zh-CN' ? 'ç”³è¯·ä¿¡æ¯:' : 
                                  currentLanguage === 'zh-TW' ? 'ç”³è«‹ä¿¡æ¯:' : 'Application Info:';
                const applyTimeLabel = currentLanguage === 'zh-CN' ? 'ç”³è¯·æ—¶é—´:' : 
                                     currentLanguage === 'zh-TW' ? 'ç”³è«‹æ™‚é–“:' : 'Applied At:';
                const kuaishouLabel = currentLanguage === 'zh-CN' ? 'å¿«æ‰‹æš—å·:' : 
                                     currentLanguage === 'zh-TW' ? 'å¿«æ‰‹æš—è™Ÿ:' : 'Kuaishou Code:';
                
                html += `<div style="margin: 16px 0; padding: 12px; background: rgba(255, 149, 0, 0.1); border-radius: 8px;">
                    <strong>${applyLabel}</strong><br>
                    <strong>${applyTimeLabel}</strong> ${new Date(appInfo.appliedAt).toLocaleString()}<br>
                    <strong>${kuaishouLabel}</strong> ${appInfo.kuaishouCode || 'æœªæä¾›'}<br>
                    <strong>ç”³è¯·æ¸ é“:</strong> ${appInfo.appliedVia || 'æœªçŸ¥'}
                </div>`;
            }

            const boundAccounts = keyData.boundAccounts || [];
            if (boundAccounts.length > 0) {
                html += `<div><strong>${boundAccountsLabel}</strong></div>`;
                boundAccounts.forEach((account, index) => {
                    const password = account.password || '';
                    
                    const accountLabel = currentLanguage === 'zh-CN' ? `è´¦å· ${index + 1}:` : 
                                       currentLanguage === 'zh-TW' ? `è³¬è™Ÿ ${index + 1}:` : `Account ${index + 1}:`;
                    const emailLabel = currentLanguage === 'zh-CN' ? 'é‚®ç®±:' : 
                                     currentLanguage === 'zh-TW' ? 'éƒµç®±:' : 'Email:';
                    const passwordLabel = currentLanguage === 'zh-CN' ? 'å¯†ç (base64):' : 
                                        currentLanguage === 'zh-TW' ? 'å¯†ç¢¼(base64):' : 'Password(base64):';
                    const bindTimeLabel = currentLanguage === 'zh-CN' ? 'ç»‘å®šæ—¶é—´:' : 
                                        currentLanguage === 'zh-TW' ? 'ç¶å®šæ™‚é–“:' : 'Bind Time:';
                    const lastLoginLabel = currentLanguage === 'zh-CN' ? 'æœ€åç™»å½•:' : 
                                         currentLanguage === 'zh-TW' ? 'æœ€å¾Œç™»éŒ„:' : 'Last Login:';
                    
                    html += `
                    <div class="account-detail-item">
                        <strong>${accountLabel}</strong><br>
                        <strong>${emailLabel}</strong> ${account.email}<br>
                        <strong>${passwordLabel}</strong> ${password}<br>
                        <strong>${bindTimeLabel}</strong> ${new Date(account.bindTime).toLocaleString()}<br>
                        <strong>${lastLoginLabel}</strong> ${new Date(account.lastLogin).toLocaleString()}
                    </div>`;
                });
            } else {
                html += `<div>${noAccountsLabel}</div>`;
            }

            detailsEl.innerHTML = html;
            modal.style.display = 'flex';
        }

        function closeAccountModal() {
            document.getElementById('accountModal').style.display = 'none';
        }

        function copyKey(keyToCopy) {
            navigator.clipboard.writeText(keyToCopy)
                .then(() => {
                    updateStatus(`${currentLanguage === 'zh-CN' ? 'ç§˜é’¥ ' : 
                                currentLanguage === 'zh-TW' ? 'ç§˜é‘° ' : 'Key '}${keyToCopy.substring(0, 4)}... ${currentLanguage === 'zh-CN' ? 'å·²å¤åˆ¶æˆåŠŸï¼' : 
                                currentLanguage === 'zh-TW' ? 'å·²è¤‡è£½æˆåŠŸï¼' : 'copied successfully!'}`, false);
                    logAction("ç§˜é’¥å¤åˆ¶", `ç§˜é’¥ ${keyToCopy} å·²å¤åˆ¶`, 'success');
                })
                .catch(err => {
                    updateStatus(currentLanguage === 'zh-CN' ? 'ç§˜é’¥å¤åˆ¶å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨å¤åˆ¶' : 
                               currentLanguage === 'zh-TW' ? 'ç§˜é‘°è¤‡è£½å¤±æ•—ï¼Œè«‹æ‰‹å‹•è¤‡è£½' : 'Key copy failed, please copy manually', true);
                    logAction("ç§˜é’¥å¤åˆ¶", `ç§˜é’¥å¤åˆ¶å¤±è´¥: ${err.message}`, 'error');
                });
        }

        function handleSwitchAccount() {
            currentUser = null;
            currentToken = null;
            localStorage.removeItem('idToken');
            localStorage.removeItem('currentUser');
            
            if (isAdminMode) {
                switchSection('loginForm', ['menuButtons', 'adminPanel']);
                updateStatus(currentLanguage === 'zh-CN' ? "è¯·ç™»å½•æ–°çš„æ¸¸æˆè´¦å·" : 
                           currentLanguage === 'zh-TW' ? "è«‹ç™»éŒ„æ–°çš„éŠæˆ²è³¬è™Ÿ" : "Please login with new game account", false);
            } else {
                switchSection('loginForm', ['menuButtons']);
                updateStatus(currentLanguage === 'zh-CN' ? "è¯·ç™»å½•æ–°çš„æ¸¸æˆè´¦å·" : 
                           currentLanguage === 'zh-TW' ? "è«‹ç™»éŒ„æ–°çš„éŠæˆ²è³¬è™Ÿ" : "Please login with new game account", false);
            }
            
            logAction("åˆ‡æ¢è´¦å·", "åˆ‡æ¢åˆ°æ–°è´¦å·ç™»å½•", 'info');
        }

        function handleSwitchKey() {
            handleLogout(true);
            updateStatus(currentLanguage === 'zh-CN' ? "è¯·è¾“å…¥æ–°çš„ç§˜é’¥" : 
                       currentLanguage === 'zh-TW' ? "è«‹è¼¸å…¥æ–°çš„ç§˜é‘°" : "Please enter new key", false);
            logAction("åˆ‡æ¢ç§˜é’¥", "åˆ‡æ¢åˆ°æ–°ç§˜é’¥è¾“å…¥", 'info');
        }

        function handleReturnHome() {
            if (isAdminMode) {
                document.getElementById('adminPanel').style.display = 'none';
                switchSection('menuButtons', ['keyForm', 'loginForm']);
            } else {
                switchSection('menuButtons', ['keyForm', 'loginForm']);
            }
            updateStatus(currentLanguage === 'zh-CN' ? "å·²è¿”å›ä¸»èœå•" : 
                       currentLanguage === 'zh-TW' ? "å·²è¿”å›ä¸»èœå–®" : "Returned to main menu", false);
            logAction("å¯¼èˆª", "è¿”å›ä¸»èœå•", 'info');
        }

        function handleLogout(silent = false) {
            localStorage.removeItem('accessKey');
            localStorage.removeItem('idToken');
            localStorage.removeItem('expiryTime');
            localStorage.removeItem('currentUser');
            
            currentUser = null;
            currentToken = null;
            currentKey = null;
            isAdminMode = false;
            isSuperAdmin = false;
            isTestCard = false;

            document.getElementById('accessKey').value = '';
            document.getElementById('email').value = '';
            document.getElementById('password').value = '';
            document.getElementById('toggleAdminModeBtn').style.display = 'none';
            document.getElementById('adminPanel').style.display = 'none';
            updateBindInfo();
            updateTestCardStatus(false);
            
            updateExpiryDisplay(null, null, null, true);
            switchSection('keyForm', ['loginForm', 'menuButtons']);

            if (!silent) {
                updateStatus(currentLanguage === 'zh-CN' ? "å·²æˆåŠŸé€€å‡ºç™»å½•ï¼Œè¯·é‡æ–°éªŒè¯ç§˜é’¥" : 
                           currentLanguage === 'zh-TW' ? "å·²æˆåŠŸé€€å‡ºç™»éŒ„ï¼Œè«‹é‡æ–°é©—è­‰ç§˜é‘°" : "Logged out successfully, please verify key again");
                logAction("é€€å‡º", "ç”¨æˆ·å·²é€€å‡ºç™»å½•", 'info');
            }
        }

        function initAuthCheck() {
            logAction("ç³»ç»Ÿåˆå§‹åŒ–", "æ£€æŸ¥æœ¬åœ°ç™»å½•çŠ¶æ€", 'info');
            const hasStored = loadAuthFromStorage();
            
            if (hasStored && currentKey) {
                updateStatus(currentLanguage === 'zh-CN' ? "å‘ç°ä¸Šæ¬¡ç™»å½•çŠ¶æ€ï¼Œæ­£åœ¨é‡æ–°éªŒè¯ç§˜é’¥..." : 
                           currentLanguage === 'zh-TW' ? "ç™¼ç¾ä¸Šæ¬¡ç™»éŒ„ç‹€æ…‹ï¼Œæ­£åœ¨é‡æ–°é©—è­‰ç§˜é‘°..." : 
                           "Found previous login status, re-verifying key...", false);
                document.getElementById('accessKey').value = currentKey; 
                
                handleCheckKey(currentKey).then(() => {
                    if(isAdminMode && currentUser && currentToken) {
                        updateStatus(currentLanguage === 'zh-CN' ? `æ¬¢è¿å›æ¥ï¼Œ${isSuperAdmin ? 'è¶…çº§ç®¡ç†å‘˜' : 'ç®¡ç†å‘˜'} ${currentUser}ã€‚` : 
                                   currentLanguage === 'zh-TW' ? `æ­¡è¿å›ä¾†ï¼Œ${isSuperAdmin ? 'è¶…ç´šç®¡ç†å“¡' : 'ç®¡ç†å“¡'} ${currentUser}ã€‚` : 
                                   `Welcome back, ${isSuperAdmin ? 'super admin' : 'admin'} ${currentUser}.`);
                        switchSection('menuButtons', ['keyForm', 'loginForm']);
                    } else if(currentUser && currentToken) {
                        updateStatus(currentLanguage === 'zh-CN' ? `æ¬¢è¿å›æ¥ï¼Œ${currentUser}ã€‚` : 
                                   currentLanguage === 'zh-TW' ? `æ­¡è¿å›ä¾†ï¼Œ${currentUser}ã€‚` : 
                                   `Welcome back, ${currentUser}.`);
                        switchSection('menuButtons', ['keyForm', 'loginForm']);
                    }
                }); 
            } else {
                switchSection('keyForm', ['loginForm', 'menuButtons']);
                updateStatus(currentLanguage === 'zh-CN' ? "è¯·å…ˆè¾“å…¥ç§˜é’¥éªŒè¯" : 
                           currentLanguage === 'zh-TW' ? "è«‹å…ˆè¼¸å…¥ç§˜é‘°é©—è­‰" : "Please verify key first");
            }
        }

        document.addEventListener("DOMContentLoaded", () => {
            applyTranslations();
            
            initAuthCheck(); 

            document.getElementById('accessKey').addEventListener('keydown', (e) => {
                if (e.key === 'Enter') handleCheckKey(); 
            });
            document.getElementById('password').addEventListener('keydown', (e) => {
                if (e.key === 'Enter') handleLogin();
            });

            document.getElementById('accountModal').addEventListener('click', (e) => {
                if (e.target.id === 'accountModal') {
                    closeAccountModal();
                }
            });

            // æ·»åŠ é¡µé¢åŠ è½½åŠ¨ç”»
            setTimeout(() => {
                document.body.style.opacity = '1';
                document.body.style.transition = 'opacity 0.5s ease';
            }, 100);
        });
    </script>
</body>
</html>
